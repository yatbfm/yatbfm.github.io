<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Keep Studying">
    <meta name="author" content="yatbfm">
    
    <title>
        
            LeetCode SQL题笔记 |
        
        yatbfm&#39;s blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/image.png">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
        
            
                
<link rel="stylesheet" href="/css/custom.css">

            
        
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"yatbfm.github.io","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"yatbfm's blog","author":"yatbfm","favicon":"/images/image.png"},"menu":{"Home":"/","Archives":"/archives","Categories":"/categories","Tags":"/tags"},"first_screen":{"enable":true,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep studying.","hitokoto":true},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":true},"home":{"category":true,"tag":true,"announcement":null},"post":{"word_count":{"wordcount":true,"min2read":true},"datetime_format":"YYYY-MM-DD HH:mm","copyright_info":true},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":true,"site_pv":true,"page_pv":true}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.21"},"waline":{"server_url":null,"reaction":false,"version":2},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2020,"word_count":false,"icp":{"enable":false,"record_code":null,"url":"https://beian.miit.gov.cn"},"site_deploy":{"enable":false,"provider":"github","url":null},"shields_style":{"enable":false,"custom":[{"link_url":null,"img_url":null}]}},"inject":{"enable":true,"css":["/css/custom.css"],"js":["/js/custom.js"]},"root":"","source_data":{},"version":"4.1.1"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 7.0.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left border-box">
            
            <a class="site-name border-box" href="/">
               yatbfm&#39;s blog
            </a>
        </div>

        <div class="right border-box">
            <div class="pc">
                <ul class="menu-list">
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                
                                首页
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                
                                归档
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                
                                分类
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                
                                标签
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/"
                    >首页</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives"
                    >归档</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories"
                    >分类</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags"
                    >标签</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        LeetCode SQL题笔记
                    </div>
                

                
                    <div class="post-header border-box">
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">yatbfm</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2023-12-01 21:39</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Wed Apr 16 2025 07:47:24 GMT+0000">2025-04-16 07:47</span>
            </span>
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/LeetCode/">LeetCode</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/LeetCode/">LeetCode</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/sql/">sql</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>11.9k 字</span>
            </span>
        
        
            <span class="meta-info-item post-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>49 分钟</span>
            </span>
        
        
            <span class="meta-info-item post-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body">
                    

                    <h1 id="上升的温度">197.上升的温度</h1>
<p>表： <code>Weather</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| recordDate    | date    |</span><br><span class="line">| temperature   | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">id 是该表具有唯一值的列。</span><br><span class="line">该表包含特定日期的温度信息</span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>编写解决方案，找出与之前（昨天的）日期相比温度更高的所有日期的
<code>id</code> 。</p>
<p>返回结果 <strong>无顺序要求</strong> 。</p>
<p>结果格式如下例子所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Weather 表：</span><br><span class="line">+----+------------+-------------+</span><br><span class="line">| id | recordDate | Temperature |</span><br><span class="line">+----+------------+-------------+</span><br><span class="line">| 1  | 2015-01-01 | 10          |</span><br><span class="line">| 2  | 2015-01-02 | 25          |</span><br><span class="line">| 3  | 2015-01-03 | 20          |</span><br><span class="line">| 4  | 2015-01-04 | 30          |</span><br><span class="line">+----+------------+-------------+</span><br><span class="line">输出：</span><br><span class="line">+----+</span><br><span class="line">| id |</span><br><span class="line">+----+</span><br><span class="line">| 2  |</span><br><span class="line">| 4  |</span><br><span class="line">+----+</span><br><span class="line">解释：</span><br><span class="line">2015-01-02 的温度比前一天高（10 -&gt; 25）</span><br><span class="line">2015-01-04 的温度比前一天高（20 -&gt; 30）</span><br></pre></td></tr></table></figure>
<h2 id="解析datediff函数">解析(datediff函数)</h2>
<p>这道题首先是要得到<code>id</code>，其次是需要比较<mark>日期</mark>和<mark>温度</mark>，温度容易比较，使用<code>&gt; &lt;</code>等即可，但是日期类型不能直接比较，否则会有问题，如1号的前一天是30号或者31号，因此需要使用日期比较函数，这里使用的是<code>datediff(日期1， 日期2)</code>函数，该函数返回的是<code>日期1 - 日期2</code>相差的天数，如<code>datediff('2023-01-11', '2023-01-10')</code>返回的是<code>1</code>，而<code>datediff('2023-01-10', '2023-01-11')</code>返回的是<code>-1</code>。</p>
<p>使用什么符号、函数进行比较解决了，接下来需要思考如何解答这道题。需要判断的是“今天”比“昨天”的温度高的，也就是说<code>datediff(今天, 昨天)</code>应该返回<code>1</code>，但是在一个表直接比较两个日期不容易实现，因此可以尝试使用自连接。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> w2.id id</span><br><span class="line"><span class="keyword">from</span> weather w1, weather w2</span><br><span class="line"><span class="keyword">where</span> datediff(w2.recordDate , w1.recordDate) <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">and</span> w2.temperature <span class="operator">&gt;</span> w1.temperature;</span><br></pre></td></tr></table></figure>
<p>以上<code>sql</code>表示，从左表<code>w1</code>（驱动表）取出所有数据，然后依次用每一条数据对比右表<code>w2</code>（被驱动表）的数据，对比的条件就是<code>datediff(w2.recordDate , w1.recordDate) = 1 and w2.temperature &gt; w1.temperature</code>，当满足这个条件时，即返回“今天”（<code>w2.id</code>）的数据，因为条件是<code>w2</code>日期比较大，如果需要返回“昨天”的数据即返回<code>w1.id</code>。</p>
<h1 id="订单最多的客户">586.订单最多的客户</h1>
<p>表: <code>Orders</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-----------------+----------+</span><br><span class="line">| Column Name     | Type     |</span><br><span class="line">+-----------------+----------+</span><br><span class="line">| order_number    | int      |</span><br><span class="line">| customer_number | int      |</span><br><span class="line">+-----------------+----------+</span><br><span class="line">在 SQL 中，Order_number是该表的主键。</span><br><span class="line">此表包含关于订单ID和客户ID的信息。</span><br></pre></td></tr></table></figure>
<p>查找下了 <strong>最多订单</strong> 的客户的
<code>customer_number</code> 。</p>
<p>测试用例生成后， <strong>恰好有一个客户</strong>
比任何其他客户下了更多的订单。</p>
<p>查询结果格式如下所示。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">输入: </span><br><span class="line">Orders 表:</span><br><span class="line">+--------------+-----------------+</span><br><span class="line">| order_number | customer_number |</span><br><span class="line">+--------------+-----------------+</span><br><span class="line">| 1            | 1               |</span><br><span class="line">| 2            | 2               |</span><br><span class="line">| 3            | 3               |</span><br><span class="line">| 4            | 3               |</span><br><span class="line">+--------------+-----------------+</span><br><span class="line">输出: </span><br><span class="line">+-----------------+</span><br><span class="line">| customer_number |</span><br><span class="line">+-----------------+</span><br><span class="line">| 3               |</span><br><span class="line">+-----------------+</span><br><span class="line">解释: </span><br><span class="line">customer_number 为 '3' 的顾客有两个订单，比顾客 '1' 或者 '2' 都要多，因为他们只有一个订单。</span><br><span class="line">所以结果是该顾客的 customer_number ，也就是 3 。</span><br></pre></td></tr></table></figure>
<p><strong>进阶：</strong>
如果有多位顾客订单数并列最多，你能找到他们所有的
<code>customer_number</code> 吗？</p>
<h2 id="解析">解析</h2>
<p>这道题需要查询<strong>最多订单</strong>的客户，表中的订单号<code>order_number</code>是主键，也就是唯一的，而客户号<code>customer_number</code>可以重复，因此相同的客户号的数量即为订单数量，很容易想到使用分组聚合，使用<code>count</code>进行查询每个客户的订单数量，然后再进行倒序排序取第一个即可查询到最多数量的客户号。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> customer_number</span><br><span class="line"><span class="keyword">from</span> orders</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_number</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(customer_number) <span class="keyword">desc</span></span><br><span class="line">limit <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>题目中进阶要求，如果多位顾客订单数并列最多，把所有的查询出来。首先可以明确，如果多个顾客订单数量都是最多的，上述代码中查询到的是最多数量，因此多个顾客订单数量最多也是这个数的大小。因此只需要再包一层查询进行嵌套，比较一下当前顾客的数量是不是等于当前数量即可。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> customer_number</span><br><span class="line"><span class="keyword">from</span> orders</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> customer_number</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(customer_number) <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">count</span>(customer_number) cnt</span><br><span class="line">    <span class="keyword">from</span> orders</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> customer_number</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> cnt <span class="keyword">desc</span></span><br><span class="line">    limit <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>略作修改，如果直接对<code>count(customer_number)</code>排序会报错，需要在<code>select</code>中进行查询取别名，然后再对别名进行排序。</p>
<h1 id="判断三角形">610.判断三角形</h1>
<p>表: <code>Triangle</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| x           | int  |</span><br><span class="line">| y           | int  |</span><br><span class="line">| z           | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">在 SQL 中，(x, y, z)是该表的主键列。</span><br><span class="line">该表的每一行包含三个线段的长度。</span><br></pre></td></tr></table></figure>
<p>对每三个线段报告它们是否可以形成一个三角形。</p>
<p>以 <strong>任意顺序</strong> 返回结果表。</p>
<p>查询结果格式如下所示。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">输入: </span><br><span class="line">Triangle 表:</span><br><span class="line">+----+----+----+</span><br><span class="line">| x  | y  | z  |</span><br><span class="line">+----+----+----+</span><br><span class="line">| 13 | 15 | 30 |</span><br><span class="line">| 10 | 20 | 15 |</span><br><span class="line">+----+----+----+</span><br><span class="line">输出: </span><br><span class="line">+----+----+----+----------+</span><br><span class="line">| x  | y  | z  | triangle |</span><br><span class="line">+----+----+----+----------+</span><br><span class="line">| 13 | 15 | 30 | No       |</span><br><span class="line">| 10 | 20 | 15 | Yes      |</span><br><span class="line">+----+----+----+----------+</span><br></pre></td></tr></table></figure>
<h2 id="解析case-when条件判断">解析(case when条件判断)</h2>
<p>题目不难，很容易理解。问题在于如何判断并且输出<code>Yes</code>or<code>No</code>。</p>
<p>这里使用<code>case when</code>进行判断。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> x, y, z, </span><br><span class="line">    <span class="keyword">case</span></span><br><span class="line">        <span class="keyword">when</span> x <span class="operator">+</span> y <span class="operator">&gt;</span> z <span class="keyword">and</span> x <span class="operator">+</span> z <span class="operator">&gt;</span> y <span class="keyword">and</span> y <span class="operator">+</span> z <span class="operator">&gt;</span> x <span class="keyword">then</span> <span class="string">'Yes'</span></span><br><span class="line">        <span class="keyword">else</span> <span class="string">'No'</span></span><br><span class="line">    <span class="keyword">end</span> <span class="string">'triangle'</span></span><br><span class="line"><span class="keyword">from</span> triangle;</span><br></pre></td></tr></table></figure>
<h1 id="只出现一次的最大数字">619.只出现一次的最大数字</h1>
<p><code>MyNumbers</code> 表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------+</span><br><span class="line">| Column Name | Type |</span><br><span class="line">+-------------+------+</span><br><span class="line">| num         | int  |</span><br><span class="line">+-------------+------+</span><br><span class="line">该表可能包含重复项（换句话说，在SQL中，该表没有主键）。</span><br><span class="line">这张表的每一行都含有一个整数。</span><br></pre></td></tr></table></figure>
<p><strong>单一数字</strong> 是在 <code>MyNumbers</code>
表中只出现一次的数字。</p>
<p>找出最大的 <strong>单一数字</strong> 。如果不存在
<strong>单一数字</strong> ，则返回 <code>null</code> 。</p>
<p>查询结果如下例所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">MyNumbers 表：</span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">| 8   |</span><br><span class="line">| 8   |</span><br><span class="line">| 3   |</span><br><span class="line">| 3   |</span><br><span class="line">| 1   |</span><br><span class="line">| 4   |</span><br><span class="line">| 5   |</span><br><span class="line">| 6   |</span><br><span class="line">+-----+</span><br><span class="line">输出：</span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">| 6   |</span><br><span class="line">+-----+</span><br><span class="line">解释：单一数字有 1、4、5 和 6 。</span><br><span class="line">6 是最大的单一数字，返回 6 。</span><br></pre></td></tr></table></figure>
<p><strong>示例 2：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">MyNumbers table:</span><br><span class="line">+-----+</span><br><span class="line">| num |</span><br><span class="line">+-----+</span><br><span class="line">| 8   |</span><br><span class="line">| 8   |</span><br><span class="line">| 7   |</span><br><span class="line">| 7   |</span><br><span class="line">| 3   |</span><br><span class="line">| 3   |</span><br><span class="line">| 3   |</span><br><span class="line">+-----+</span><br><span class="line">输出：</span><br><span class="line">+------+</span><br><span class="line">| num  |</span><br><span class="line">+------+</span><br><span class="line">| null |</span><br><span class="line">+------+</span><br><span class="line">解释：输入的表中不存在单一数字，所以返回 null 。</span><br></pre></td></tr></table></figure>
<h2 id="解析max函数">解析(max函数)</h2>
<p>题目容易理解，可以分为两部分解决，首先是查询到只出现了一次的数字，然后从中取最大值。</p>
<p>其中的比较难处理的是如果没有出现一次的数字，需要返回null。</p>
<p>这里使用嵌套查询和<code>max</code>函数。其中<code>max</code>函数在查询表为空时会返回<code>null</code>值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(num) num</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> num</span><br><span class="line">    <span class="keyword">from</span> mynumbers</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> num</span><br><span class="line">    <span class="keyword">having</span> <span class="built_in">count</span>(num) <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">) t</span><br></pre></td></tr></table></figure>
<h1 id="销售分析iii">1084.销售分析III</h1>
<p>表： <code>Product</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">| unit_price   | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id 是该表的主键（具有唯一值的列）。</span><br><span class="line">该表的每一行显示每个产品的名称和价格。</span><br></pre></td></tr></table></figure>
<p>表：<code>Sales</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| seller_id   | int     |</span><br><span class="line">| product_id  | int     |</span><br><span class="line">| buyer_id    | int     |</span><br><span class="line">| sale_date   | date    |</span><br><span class="line">| quantity    | int     |</span><br><span class="line">| price       | int     |</span><br><span class="line">+------ ------+---------+</span><br><span class="line">这个表可能有重复的行。</span><br><span class="line">product_id 是 Product 表的外键（reference 列）。</span><br><span class="line">该表的每一行包含关于一个销售的一些信息。</span><br></pre></td></tr></table></figure>
<p>编写解决方案，报告<code>2019年春季</code>才售出的产品。即<strong>仅</strong>在<code>2019-01-01</code>至<code>2019-03-31</code>（含）之间出售的商品。</p>
<p>以 <strong>任意顺序</strong> 返回结果表。</p>
<p>结果格式如下所示。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Product table:</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| product_id | product_name | unit_price |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">| 1          | S8           | 1000       |</span><br><span class="line">| 2          | G4           | 800        |</span><br><span class="line">| 3          | iPhone       | 1400       |</span><br><span class="line">+------------+--------------+------------+</span><br><span class="line">Sales table:</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| seller_id | product_id | buyer_id | sale_date  | quantity | price |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">| 1         | 1          | 1        | 2019-01-21 | 2        | 2000  |</span><br><span class="line">| 1         | 2          | 2        | 2019-02-17 | 1        | 800   |</span><br><span class="line">| 2         | 2          | 3        | 2019-06-02 | 1        | 800   |</span><br><span class="line">| 3         | 3          | 4        | 2019-05-13 | 2        | 2800  |</span><br><span class="line">+-----------+------------+----------+------------+----------+-------+</span><br><span class="line">输出：</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| product_id  | product_name |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | S8           |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">解释:</span><br><span class="line">id 为 1 的产品仅在 2019 年春季销售。</span><br><span class="line">id 为 2 的产品在 2019 年春季销售，但也在 2019 年春季之后销售。</span><br><span class="line">id 为 3 的产品在 2019 年春季之后销售。</span><br><span class="line">我们只返回 id 为 1 的产品，因为它是 2019 年春季才销售的产品。</span><br></pre></td></tr></table></figure>
<h2 id="解析count条件计数">解析(count条件计数)</h2>
<p>这道题是要寻找仅在第一季度销售的产品，转换思路是：在第一季度销售的产品数量和销售的总产品数量是相等的。</p>
<p>因此可以利用<code>count</code>函数的条件计数来做。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.product_id, p.product_name</span><br><span class="line"><span class="keyword">from</span> Sales s</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Product p</span><br><span class="line"><span class="keyword">on</span> s.product_id <span class="operator">=</span> p.product_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> s.product_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(s.sale_date <span class="keyword">between</span> <span class="string">'2019-01-01'</span> <span class="keyword">and</span> <span class="string">'2019-03-31'</span> <span class="keyword">or</span> <span class="keyword">null</span>) <span class="operator">=</span> <span class="built_in">count</span>(<span class="operator">*</span>);</span><br></pre></td></tr></table></figure>
<p>其中<code>count(s.sale_date between '2019-01-01' and '2019-03-31' or null)</code>中的<code>or null</code>是固定写法，不写的话等价于<code>count(*)</code>。也可以写成<code>count(if(s.sale_date between '2019-01-01' and '2019-03-31', 1, null))</code></p>
<h1 id="mysql常用四舍五入函数">MySQL常用四舍五入函数</h1>
<table>
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>floor(x)</td>
<td>返回不大于x的最大整数（下取整）</td>
</tr>
<tr>
<td>ceil(x), ceiling(x)</td>
<td>返回不小于x的最小整数（上取整）</td>
</tr>
<tr>
<td>truncate(x, d)</td>
<td>返回数值x保留到小数点后d位的值，直接截断，不四舍五入</td>
</tr>
<tr>
<td>round(x, d)</td>
<td>保留小数点后d位的值，截断时四舍五入</td>
</tr>
<tr>
<td>format(x, d)</td>
<td>将数字x格式化，保留到小数点后d位，截断时四舍五入</td>
</tr>
</tbody>
</table>
<h1 id="mysql常用字符串函数">MySQL常用字符串函数</h1>
<table>
<colgroup>
<col style="width: 31%">
<col style="width: 68%">
</colgroup>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>left(str, len)</td>
<td>字符串从左向右截取len长度的字符串</td>
</tr>
<tr>
<td>right(str, len)</td>
<td>字符串从右向左截取len长度的字符串</td>
</tr>
<tr>
<td>substring(str, pos [, len])</td>
<td>字符串从pos位置开始截取长度为len的字符串，如果len省略，则截取到最后</td>
</tr>
<tr>
<td>upper(str)</td>
<td>大写字符串</td>
</tr>
<tr>
<td>lower(str)</td>
<td>小写字符串</td>
</tr>
<tr>
<td>concat(str1, str2 [, ...])</td>
<td>连接字符串</td>
</tr>
<tr>
<td>length(str)</td>
<td>返回字符串的存储长度</td>
</tr>
<tr>
<td>char_length(str)</td>
<td>返回字符串的字符长度</td>
</tr>
</tbody>
</table>
<h1 id="mysql时间日期函数">MySQL时间日期函数</h1>
<table>
<colgroup>
<col style="width: 39%">
<col style="width: 60%">
</colgroup>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>datediff(endtime, starttime)</td>
<td>比较两个日期相差多少天，返回endtime - starttime相差的数值</td>
</tr>
<tr>
<td>timediff(endtime, starttime)</td>
<td>比较两个日期相差多长时间，返回endtime -
starttime相差的时间，以hh:MM:ss形式返回</td>
</tr>
<tr>
<td>timestampdiff(unit, starttime, endtime)</td>
<td>按照unit指定的单位返回endtime - starttime，如second day等</td>
</tr>
<tr>
<td>weekday(time)</td>
<td>返回星期的索引，0表示星期一，1表示星期二，以此类推</td>
</tr>
<tr>
<td>date_format(time, format)</td>
<td>date_format(now(), '%Y-%m-%d
%H:%i:%s')格式化成年月日时分秒的形式，注意分钟是<strong>%i</strong></td>
</tr>
<tr>
<td>str_to_date(time, format)</td>
<td>将字符串转成日期</td>
</tr>
</tbody>
</table>
<p><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45453266/article/details/106781772">mysql
between and 边界问题-CSDN博客<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" target="_blank" rel="noopener" href="https://www.cnblogs.com/east7/p/13257516.html">SQL语句between
and边界问题 - 楼兰胡杨 - 博客园 (cnblogs.com)<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="sql执行顺序">sql执行顺序</h1>
<p><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40912214/article/details/113564284">mysql
中的select,from,where,group by等 关键字 执行顺序与别名问题_mysql join
where group 顺序-CSDN博客<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/95984838">SQL高级:窗口函数+聚合函数 -
知乎 (zhihu.com)<i class="fas fa-external-link-alt"></i></a></p>
<h1 id="重新格式化部门表">1179.重新格式化部门表</h1>
<div id="1179.重新格式化部门表">

</div>
<p>表 <code>Department</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| id            | int     |</span><br><span class="line">| revenue       | int     |</span><br><span class="line">| month         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">在 SQL 中，(id, month) 是表的联合主键。</span><br><span class="line">这个表格有关于每个部门每月收入的信息。</span><br><span class="line">月份（month）可以取下列值 ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]。</span><br></pre></td></tr></table></figure>
<p>重新格式化表格，使得 <strong>每个月</strong> 都有一个部门 id
列和一个收入列。</p>
<p>以 <strong>任意顺序</strong> 返回结果表。</p>
<p>结果格式如以下示例所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Department table:</span><br><span class="line">+------+---------+-------+</span><br><span class="line">| id   | revenue | month |</span><br><span class="line">+------+---------+-------+</span><br><span class="line">| 1    | 8000    | Jan   |</span><br><span class="line">| 2    | 9000    | Jan   |</span><br><span class="line">| 3    | 10000   | Feb   |</span><br><span class="line">| 1    | 7000    | Feb   |</span><br><span class="line">| 1    | 6000    | Mar   |</span><br><span class="line">+------+---------+-------+</span><br><span class="line">输出：</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line">| id   | Jan_Revenue | Feb_Revenue | Mar_Revenue | ... | Dec_Revenue |</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line">| 1    | 8000        | 7000        | 6000        | ... | null        |</span><br><span class="line">| 2    | 9000        | null        | null        | ... | null        |</span><br><span class="line">| 3    | null        | 10000       | null        | ... | null        |</span><br><span class="line">+------+-------------+-------------+-------------+-----+-------------+</span><br><span class="line">解释：四月到十二月的收入为空。 </span><br><span class="line">请注意，结果表共有 13 列（1 列用于部门 ID，其余 12 列用于各个月份）。</span><br></pre></td></tr></table></figure>
<h2 id="解析group-by原理行转列">解析(group by原理，行转列)</h2>
<p>一道行转列问题。参考<a class="link" target="_blank" rel="noopener" href="https://leetcode.cn/problems/reformat-department-table/solutions/343480/guan-yu-group-byyu-sumde-pei-he-by-xxiao053/">力扣题解<i class="fas fa-external-link-alt"></i></a>。</p>
<p>首先需要了解<code>group by</code>的原理，可以参考<a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/u014717572/article/details/80687042">链接<i class="fas fa-external-link-alt"></i></a>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    id</span><br><span class="line">    , <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="string">'Jan'</span> <span class="keyword">then</span> revenue <span class="keyword">end</span>) Jan_Revenue</span><br><span class="line">    , <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="string">'Feb'</span> <span class="keyword">then</span> revenue <span class="keyword">end</span>) Feb_Revenue</span><br><span class="line">    , <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="string">'Mar'</span> <span class="keyword">then</span> revenue <span class="keyword">end</span>) Mar_Revenue</span><br><span class="line">    , <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="string">'Apr'</span> <span class="keyword">then</span> revenue <span class="keyword">end</span>) Apr_Revenue</span><br><span class="line">    , <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="string">'May'</span> <span class="keyword">then</span> revenue <span class="keyword">end</span>) May_Revenue</span><br><span class="line">    , <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="string">'Jun'</span> <span class="keyword">then</span> revenue <span class="keyword">end</span>) Jun_Revenue</span><br><span class="line">    , <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="string">'Jul'</span> <span class="keyword">then</span> revenue <span class="keyword">end</span>) Jul_Revenue</span><br><span class="line">    , <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="string">'Aug'</span> <span class="keyword">then</span> revenue <span class="keyword">end</span>) Aug_Revenue</span><br><span class="line">    , <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="string">'Sep'</span> <span class="keyword">then</span> revenue <span class="keyword">end</span>) Sep_Revenue</span><br><span class="line">    , <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="string">'Oct'</span> <span class="keyword">then</span> revenue <span class="keyword">end</span>) Oct_Revenue</span><br><span class="line">    , <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="string">'Nov'</span> <span class="keyword">then</span> revenue <span class="keyword">end</span>) Nov_Revenue</span><br><span class="line">    , <span class="built_in">sum</span>(<span class="keyword">case</span> <span class="keyword">when</span> <span class="keyword">month</span> <span class="operator">=</span> <span class="string">'Dec'</span> <span class="keyword">then</span> revenue <span class="keyword">end</span>) Dec_Revenue</span><br><span class="line"><span class="keyword">from</span> Department</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> id;</span><br></pre></td></tr></table></figure>
<p>这里主要解释一下代码中为什么要使用<code>sum</code>聚合函数。</p>
<p>分组后的虚拟表可以看成如下形式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+------+---------+-------+</span><br><span class="line">| id   | revenue | month |</span><br><span class="line">+------+---------+-------+</span><br><span class="line">|      | 8000    | Jan   |</span><br><span class="line">| 1    | 7000    | Feb   |</span><br><span class="line">|      | 6000    | Mar   |</span><br><span class="line">+------+---------+-------+</span><br><span class="line">| 2    | 9000    | Jan   |</span><br><span class="line">+------+---------+-------+</span><br><span class="line">| 3    | 10000   | Feb   |</span><br><span class="line">+------+---------+-------+</span><br></pre></td></tr></table></figure>
<p>因为<code>case when</code>条件只读取单元格中第一个数据，而分组后的单元格<code>month</code>列的单元格可能会有多个数据，因此需要遍历单元格所有数据，所以需要使用聚合函数进行遍历。每一个查询属性在单元格中只会对应一个数据或者没有对应数据，也就是结果为<code>revenue</code>或者<code>null</code>，因此结果没有偏差。</p>
<h1 id="每个产品在不同商店的价格">1795.每个产品在不同商店的价格</h1>
<p>表：<code>Products</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| product_id  | int     |</span><br><span class="line">| store1      | int     |</span><br><span class="line">| store2      | int     |</span><br><span class="line">| store3      | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">在 SQL 中，这张表的主键是 product_id（产品Id）。</span><br><span class="line">每行存储了这一产品在不同商店 store1, store2, store3 的价格。</span><br><span class="line">如果这一产品在商店里没有出售，则值将为 null。</span><br></pre></td></tr></table></figure>
<p>请你重构 <code>Products</code>
表，查询每个产品在不同商店的价格，使得输出的格式变为<code>(product_id, store, price)</code>
。如果这一产品在商店里没有出售，则不输出这一行。</p>
<p>输出结果表中的 <strong>顺序不作要求</strong> 。</p>
<p>查询输出格式请参考下面示例。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Products table:</span><br><span class="line">+------------+--------+--------+--------+</span><br><span class="line">| product_id | store1 | store2 | store3 |</span><br><span class="line">+------------+--------+--------+--------+</span><br><span class="line">| 0          | 95     | 100    | 105    |</span><br><span class="line">| 1          | 70     | null   | 80     |</span><br><span class="line">+------------+--------+--------+--------+</span><br><span class="line">输出：</span><br><span class="line">+------------+--------+-------+</span><br><span class="line">| product_id | store  | price |</span><br><span class="line">+------------+--------+-------+</span><br><span class="line">| 0          | store1 | 95    |</span><br><span class="line">| 0          | store2 | 100   |</span><br><span class="line">| 0          | store3 | 105   |</span><br><span class="line">| 1          | store1 | 70    |</span><br><span class="line">| 1          | store3 | 80    |</span><br><span class="line">+------------+--------+-------+</span><br><span class="line">解释：</span><br><span class="line">产品 0 在 store1、store2、store3 的价格分别为 95、100、105。</span><br><span class="line">产品 1 在 store1、store3 的价格分别为 70、80。在 store2 无法买到。</span><br></pre></td></tr></table></figure>
<h2 id="解析列转行">解析(列转行)</h2>
<p>这是一道列转行问题，解题思路如下：</p>
<ul>
<li>一列一列处理：把原来的<strong>列名</strong>作为新列(store)的<strong>value</strong>，原来的列的<strong>value</strong>作为另一个新列(price)的<strong>value</strong>。</li>
<li>将所有结果<code>union all</code>合并</li>
<li>值为<code>null</code>的需要跳过</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_id, <span class="string">'store1'</span> store, store1 price</span><br><span class="line"><span class="keyword">from</span> Products</span><br><span class="line"><span class="keyword">where</span> store1 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> product_id, <span class="string">'store2'</span> store, store2 price</span><br><span class="line"><span class="keyword">from</span> Products</span><br><span class="line"><span class="keyword">where</span> store2 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> product_id, <span class="string">'store3'</span> store, store3 price</span><br><span class="line"><span class="keyword">from</span> Products</span><br><span class="line"><span class="keyword">where</span> store3 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>
<p>这里新列<code>'store1' store</code>等需要加引号，因为这是要把常量值为<code>'store1'</code>的作为<code>store</code>列，如果不加引号，则是认为<code>store1</code>这列的值作为<code>store</code>列。</p>
<h1 id="平均售价">1251.平均售价</h1>
<p>表：<code>Prices</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| start_date    | date    |</span><br><span class="line">| end_date      | date    |</span><br><span class="line">| price         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(product_id，start_date，end_date) 是 prices 表的主键（具有唯一值的列的组合）。</span><br><span class="line">prices 表的每一行表示的是某个产品在一段时期内的价格。</span><br><span class="line">每个产品的对应时间段是不会重叠的，这也意味着同一个产品的价格时段不会出现交叉。</span><br></pre></td></tr></table></figure>
<p>表：<code>UnitsSold</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| purchase_date | date    |</span><br><span class="line">| units         | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">该表可能包含重复数据。</span><br><span class="line">该表的每一行表示的是每种产品的出售日期，单位和产品 id。</span><br></pre></td></tr></table></figure>
<p>编写解决方案以查找每种产品的平均售价。<code>average_price</code> 应该
<strong>四舍五入到小数点后两位</strong>。</p>
<p>返回结果表 <strong>无顺序要求</strong> 。</p>
<p>结果格式如下例所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Prices table:</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line">| product_id | start_date | end_date   | price  |</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line">| 1          | 2019-02-17 | 2019-02-28 | 5      |</span><br><span class="line">| 1          | 2019-03-01 | 2019-03-22 | 20     |</span><br><span class="line">| 2          | 2019-02-01 | 2019-02-20 | 15     |</span><br><span class="line">| 2          | 2019-02-21 | 2019-03-31 | 30     |</span><br><span class="line">+------------+------------+------------+--------+</span><br><span class="line">UnitsSold table:</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line">| product_id | purchase_date | units |</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line">| 1          | 2019-02-25    | 100   |</span><br><span class="line">| 1          | 2019-03-01    | 15    |</span><br><span class="line">| 2          | 2019-02-10    | 200   |</span><br><span class="line">| 2          | 2019-03-22    | 30    |</span><br><span class="line">+------------+---------------+-------+</span><br><span class="line">输出：</span><br><span class="line">+------------+---------------+</span><br><span class="line">| product_id | average_price |</span><br><span class="line">+------------+---------------+</span><br><span class="line">| 1          | 6.96          |</span><br><span class="line">| 2          | 16.96         |</span><br><span class="line">+------------+---------------+</span><br><span class="line">解释：</span><br><span class="line">平均售价 = 产品总价 / 销售的产品数量。</span><br><span class="line">产品 1 的平均售价 = ((100 * 5)+(15 * 20) )/ 115 = 6.96</span><br><span class="line">产品 2 的平均售价 = ((200 * 15)+(30 * 30) )/ 230 = 16.96</span><br></pre></td></tr></table></figure>
<h2 id="解析-1">解析</h2>
<p>这道题难点在于使用聚合函数将两个表的<code>units</code>和<code>price</code>进行相加再求平均值无法使用聚合函数对两个表操作，因此需要先利用<code>product_id</code>进行左外连接合并成一个表然后进行连接操作。使用左外连接的原因是产品可能没有卖出去，但是定价是存在的，所以保证每个产品都被查询到，需要使用左外连接。连接后需要满足条件，售卖的日期需要是在定价<code>开始日期</code>到<code>结束日期</code>之间的，左外连接是以左表为基础的全连接，会连接出来不满足条件的数据行，因此需要根据这个条件进行过滤，同时为了保证没有售卖的数据可以保留下来，需要再添加一个<code>null</code>的特殊处理。</p>
<p>一个测试用例，进行左外连接没有过滤的数据如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">| product_id | start_date | end_date   | price | product_id | purchase_date | units |</span><br><span class="line">| ---------- | ---------- | ---------- | ----- | ---------- | ------------- | ----- |</span><br><span class="line">| 1          | 2019-02-17 | 2019-02-28 | 5     | 1          | 2019-03-01    | 15    |</span><br><span class="line">| 1          | 2019-02-17 | 2019-02-28 | 5     | 1          | 2019-02-25    | 100   |</span><br><span class="line">| 1          | 2019-03-01 | 2019-03-22 | 20    | 1          | 2019-03-01    | 15    |</span><br><span class="line">| 1          | 2019-03-01 | 2019-03-22 | 20    | 1          | 2019-02-25    | 100   |</span><br><span class="line">| 2          | 2019-02-01 | 2019-02-20 | 15    | 2          | 2019-03-22    | 30    |</span><br><span class="line">| 2          | 2019-02-01 | 2019-02-20 | 15    | 2          | 2019-02-10    | 200   |</span><br><span class="line">| 2          | 2019-02-21 | 2019-03-31 | 30    | 2          | 2019-03-22    | 30    |</span><br><span class="line">| 2          | 2019-02-21 | 2019-03-31 | 30    | 2          | 2019-02-10    | 200   |</span><br><span class="line">| 3          | 2019-02-21 | 2019-03-31 | 30    | null       | null          | null  |</span><br></pre></td></tr></table></figure>
<p>最后使用聚合函数进行求平均价格，注意的是如果该产品没有卖出去，在连接后会出现<code>null</code>的情况，可以使用<code>ifnull</code>函数进行特殊判断。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    p.product_id</span><br><span class="line">    , round(ifnull(<span class="built_in">sum</span>(units <span class="operator">*</span> price) <span class="operator">/</span> <span class="built_in">sum</span>(units), <span class="number">0</span>), <span class="number">2</span>) average_price</span><br><span class="line"><span class="keyword">from</span> Prices p</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> UnitsSold u</span><br><span class="line"><span class="keyword">on</span> u.product_id <span class="operator">=</span> p.product_id</span><br><span class="line"><span class="keyword">where</span> u.purchase_date <span class="keyword">between</span> p.start_date <span class="keyword">and</span> p.end_date <span class="keyword">or</span> u.purchase_date <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> p.product_id;</span><br></pre></td></tr></table></figure>
<h1 id="学生们参加各科测试的次数">1280.学生们参加各科测试的次数</h1>
<p>学生表: <code>Students</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| student_id    | int     |</span><br><span class="line">| student_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">在 SQL 中，主键为 student_id（学生ID）。</span><br><span class="line">该表内的每一行都记录有学校一名学生的信息。</span><br></pre></td></tr></table></figure>
<p>科目表: <code>Subjects</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| subject_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">在 SQL 中，主键为 subject_name（科目名称）。</span><br><span class="line">每一行记录学校的一门科目名称。</span><br></pre></td></tr></table></figure>
<p>考试表: <code>Examinations</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| student_id   | int     |</span><br><span class="line">| subject_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">这个表可能包含重复数据（换句话说，在 SQL 中，这个表没有主键）。</span><br><span class="line">学生表里的一个学生修读科目表里的每一门科目。</span><br><span class="line">这张考试表的每一行记录就表示学生表里的某个学生参加了一次科目表里某门科目的测试。</span><br></pre></td></tr></table></figure>
<p>查询出每个学生参加每一门科目测试的次数，结果按
<code>student_id</code> 和 <code>subject_name</code> 排序。</p>
<p>查询结构格式如下所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Students table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| student_id | student_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 1          | Alice        |</span><br><span class="line">| 2          | Bob          |</span><br><span class="line">| 13         | John         |</span><br><span class="line">| 6          | Alex         |</span><br><span class="line">+------------+--------------+</span><br><span class="line">Subjects table:</span><br><span class="line">+--------------+</span><br><span class="line">| subject_name |</span><br><span class="line">+--------------+</span><br><span class="line">| Math         |</span><br><span class="line">| Physics      |</span><br><span class="line">| Programming  |</span><br><span class="line">+--------------+</span><br><span class="line">Examinations table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| student_id | subject_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 1          | Math         |</span><br><span class="line">| 1          | Physics      |</span><br><span class="line">| 1          | Programming  |</span><br><span class="line">| 2          | Programming  |</span><br><span class="line">| 1          | Physics      |</span><br><span class="line">| 1          | Math         |</span><br><span class="line">| 13         | Math         |</span><br><span class="line">| 13         | Programming  |</span><br><span class="line">| 13         | Physics      |</span><br><span class="line">| 2          | Math         |</span><br><span class="line">| 1          | Math         |</span><br><span class="line">+------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+------------+--------------+--------------+----------------+</span><br><span class="line">| student_id | student_name | subject_name | attended_exams |</span><br><span class="line">+------------+--------------+--------------+----------------+</span><br><span class="line">| 1          | Alice        | Math         | 3              |</span><br><span class="line">| 1          | Alice        | Physics      | 2              |</span><br><span class="line">| 1          | Alice        | Programming  | 1              |</span><br><span class="line">| 2          | Bob          | Math         | 1              |</span><br><span class="line">| 2          | Bob          | Physics      | 0              |</span><br><span class="line">| 2          | Bob          | Programming  | 1              |</span><br><span class="line">| 6          | Alex         | Math         | 0              |</span><br><span class="line">| 6          | Alex         | Physics      | 0              |</span><br><span class="line">| 6          | Alex         | Programming  | 0              |</span><br><span class="line">| 13         | John         | Math         | 1              |</span><br><span class="line">| 13         | John         | Physics      | 1              |</span><br><span class="line">| 13         | John         | Programming  | 1              |</span><br><span class="line">+------------+--------------+--------------+----------------+</span><br><span class="line">解释：</span><br><span class="line">结果表需包含所有学生和所有科目（即便测试次数为0）：</span><br><span class="line">Alice 参加了 3 次数学测试, 2 次物理测试，以及 1 次编程测试；</span><br><span class="line">Bob 参加了 1 次数学测试, 1 次编程测试，没有参加物理测试；</span><br><span class="line">Alex 啥测试都没参加；</span><br><span class="line">John  参加了数学、物理、编程测试各 1 次。</span><br></pre></td></tr></table></figure>
<h2 id="解析-2">解析</h2>
<p>第一次做这道题，因为样例输出学生没有参加的科目的考试输出次数为0，因此首先想到了使用左外连接，让<code>Students</code>是左表，然后连接另外两个表，但是这只能保证找到所有学生，并不能找到所有学生和所有科目。因此需要转变思路。</p>
<p>要保证有所有学生的所有科目，而<code>Students</code>和<code>Subjects</code>表是完整的学生和科目数据，因此可以使用交叉连接获得所有学生的考所有科目的信息，然后再从<code>Examinations</code>表中获取每个学生考每科的次数，进行连接即可。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    stu.student_id</span><br><span class="line">    , stu.student_name</span><br><span class="line">    , sub.subject_name</span><br><span class="line">    , ifnull(exams.attended_exams, <span class="number">0</span>) attended_exams</span><br><span class="line"><span class="keyword">from</span> Students stu</span><br><span class="line"><span class="keyword">cross</span> <span class="keyword">join</span> Subjects sub</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> (</span><br><span class="line">    <span class="keyword">select</span> student_id, subject_name, <span class="built_in">count</span>(<span class="operator">*</span>) attended_exams</span><br><span class="line">    <span class="keyword">from</span> Examinations</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> student_id, subject_name</span><br><span class="line">) exams</span><br><span class="line"><span class="keyword">on</span> stu.student_id <span class="operator">=</span> exams.student_id</span><br><span class="line"><span class="keyword">and</span> sub.subject_name <span class="operator">=</span> exams.subject_name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> stu.student_id, sub.subject_name;</span><br></pre></td></tr></table></figure>
<p>参考了其他人的<a class="link" target="_blank" rel="noopener" href="https://leetcode.cn/problems/students-and-examinations/solutions/80906/san-biao-lian-he-cha-xun-cross-join-left-join-by-s/">题解<i class="fas fa-external-link-alt"></i></a>后，对代码进行了修改。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    stu.student_id</span><br><span class="line">    , stu.student_name</span><br><span class="line">    , sub.subject_name</span><br><span class="line">    , <span class="built_in">count</span>(exams.subject_name) attended_exams</span><br><span class="line"><span class="keyword">from</span> Students stu</span><br><span class="line"><span class="keyword">cross</span> <span class="keyword">join</span> Subjects sub</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> Examinations exams</span><br><span class="line"><span class="keyword">on</span> stu.student_id <span class="operator">=</span> exams.student_id</span><br><span class="line"><span class="keyword">and</span> sub.subject_name <span class="operator">=</span> exams.subject_name</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> stu.student_id, sub.subject_name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> stu.student_id, sub.subject_name;</span><br></pre></td></tr></table></figure>
<h1 id="按日期分组销售产品">1484.按日期分组销售产品</h1>
<p>表 <code>Activities</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| 列名         | 类型    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| sell_date   | date    |</span><br><span class="line">| product     | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">该表没有主键(具有唯一值的列)。它可能包含重复项。</span><br><span class="line">此表的每一行都包含产品名称和在市场上销售的日期。</span><br></pre></td></tr></table></figure>
<p>编写解决方案找出每个日期、销售的不同产品的数量及其名称。
每个日期的销售产品名称应按词典序排列。 返回按 <code>sell_date</code>
排序的结果表。 结果表结果格式如下例所示。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Activities 表：</span><br><span class="line">+------------+-------------+</span><br><span class="line">| sell_date  | product     |</span><br><span class="line">+------------+-------------+</span><br><span class="line">| 2020-05-30 | Headphone   |</span><br><span class="line">| 2020-06-01 | Pencil      |</span><br><span class="line">| 2020-06-02 | Mask        |</span><br><span class="line">| 2020-05-30 | Basketball  |</span><br><span class="line">| 2020-06-01 | Bible       |</span><br><span class="line">| 2020-06-02 | Mask        |</span><br><span class="line">| 2020-05-30 | T-Shirt     |</span><br><span class="line">+------------+-------------+</span><br><span class="line">输出：</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">| sell_date  | num_sold | products                     |</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">| 2020-05-30 | 3        | Basketball,Headphone,T-shirt |</span><br><span class="line">| 2020-06-01 | 2        | Bible,Pencil                 |</span><br><span class="line">| 2020-06-02 | 1        | Mask                         |</span><br><span class="line">+------------+----------+------------------------------+</span><br><span class="line">解释：</span><br><span class="line">对于2020-05-30，出售的物品是 (Headphone, Basketball, T-shirt)，按词典序排列，并用逗号 ',' 分隔。</span><br><span class="line">对于2020-06-01，出售的物品是 (Pencil, Bible)，按词典序排列，并用逗号分隔。</span><br><span class="line">对于2020-06-02，出售的物品是 (Mask)，只需返回该物品名。</span><br></pre></td></tr></table></figure>
<h2 id="解析group_concat函数">解析(group_concat函数)</h2>
<p>这道题难点在于<code>group_concat</code>函数的使用。参考了<a class="link" target="_blank" rel="noopener" href="https://www.jianshu.com/p/7a1df0ce6d00">博客<i class="fas fa-external-link-alt"></i></a></p>
<p>这个函数的语法范式：<code>group_concat([distinct] 需要连接的字段名 [order by 排序字段 desc/asc] [separator '分隔符'])</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    sell_date</span><br><span class="line">    , <span class="built_in">count</span>(<span class="keyword">distinct</span> product) num_sold</span><br><span class="line">    , group_concat(</span><br><span class="line">        <span class="keyword">distinct</span> product</span><br><span class="line">        <span class="keyword">order</span> <span class="keyword">by</span> product <span class="keyword">asc</span></span><br><span class="line">        separator <span class="string">','</span></span><br><span class="line">    ) products</span><br><span class="line"><span class="keyword">from</span> Activities</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> sell_date;</span><br></pre></td></tr></table></figure>
<h1 id="查找拥有有效邮箱的用户">1517.查找拥有有效邮箱的用户</h1>
<p>表: <code>Users</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| mail          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">user_id 是该表的主键（具有唯一值的列）。</span><br><span class="line">该表包含了网站已注册用户的信息。有一些电子邮件是无效的。</span><br></pre></td></tr></table></figure>
<p>编写一个解决方案，以查找具有有效电子邮件的用户。</p>
<p>一个有效的电子邮件具有前缀名称和域，其中：</p>
<ol type="1">
<li><strong>前缀</strong>
名称是一个字符串，可以包含字母（大写或小写），数字，下划线
<code>'_'</code> ，点 <code>'.'</code> 和/或破折号 <code>'-'</code>
。前缀名称 <strong>必须</strong> 以字母开头。</li>
<li><strong>域</strong> 为 <code>'@leetcode.com'</code> 。</li>
</ol>
<p>以任何顺序返回结果表。</p>
<p>结果的格式如以下示例所示：</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Users 表:</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| user_id | name      | mail                    |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| 1       | Winston   | winston@leetcode.com    |</span><br><span class="line">| 2       | Jonathan  | jonathanisgreat         |</span><br><span class="line">| 3       | Annabelle | bella-@leetcode.com     |</span><br><span class="line">| 4       | Sally     | sally.come@leetcode.com |</span><br><span class="line">| 5       | Marwan    | quarz#2020@leetcode.com |</span><br><span class="line">| 6       | David     | david69@gmail.com       |</span><br><span class="line">| 7       | Shapiro   | .shapo@leetcode.com     |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">输出：</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| user_id | name      | mail                    |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">| 1       | Winston   | winston@leetcode.com    |</span><br><span class="line">| 3       | Annabelle | bella-@leetcode.com     |</span><br><span class="line">| 4       | Sally     | sally.come@leetcode.com |</span><br><span class="line">+---------+-----------+-------------------------+</span><br><span class="line">解释：</span><br><span class="line">用户 2 的电子邮件没有域。 </span><br><span class="line">用户 5 的电子邮件带有不允许的 '#' 符号。</span><br><span class="line">用户 6 的电子邮件没有 leetcode 域。 </span><br><span class="line">用户 7 的电子邮件以点开头。</span><br></pre></td></tr></table></figure>
<h2 id="解析正则表达式的应用">解析(正则表达式的应用)</h2>
<p><code>^</code> 表示以后面的字符为开头 <code>[]</code>
表示括号内任意字符</p>
<p><code>-</code> 表示连续</p>
<p><code>*</code> 表示重复前面任意字符任意次数 <code>\</code>
用来转义后面的特殊字符，以表示字符原本的样子，而不是将其作为特殊字符使用
<code>$</code> 表示以前面的字符为结尾</p>
<p>因此，前缀必须以字母开头可以表示<code>^[a-zA-Z]</code>，前缀名包含若干数字、下划线、句点、横杠<code>[a-zA-Z0-9_\.\-]*</code>，以<code>@leetcode.com</code>结尾则是<code>\@leetcode\.com$</code>。因为<code>. - @</code>属于特殊字符，要使用本身的时候需要加<code>\</code>转义。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> Users</span><br><span class="line"><span class="keyword">where</span> mail regexp <span class="string">'^[a-zA-Z][a-zA-Z0-9_\\.\\-]*\\@leetcode\\.com$'</span>;</span><br></pre></td></tr></table></figure>
<p>正则表达式中使用<code>\.</code>进行转义，而在MySQL中需要对<code>\</code>进行转义，因此需要再加一个<code>\</code>。</p>
<h1 id="患某种疾病的患者">1527.患某种疾病的患者</h1>
<p>患者信息表： <code>Patients</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| patient_id   | int     |</span><br><span class="line">| patient_name | varchar |</span><br><span class="line">| conditions   | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">在 SQL 中，patient_id （患者 ID）是该表的主键。</span><br><span class="line">'conditions' （疾病）包含 0 个或以上的疾病代码，以空格分隔。</span><br><span class="line">这个表包含医院中患者的信息。</span><br></pre></td></tr></table></figure>
<p>查询患有 I 类糖尿病的患者 ID
（patient_id）、患者姓名（patient_name）以及其患有的所有疾病代码（conditions）。I
类糖尿病的代码总是包含前缀 <code>DIAB1</code> 。</p>
<p>按 <strong>任意顺序</strong> 返回结果表。</p>
<p>查询结果格式如下示例所示。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Patients表：</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| patient_id | patient_name | conditions   |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| 1          | Daniel       | YFEV COUGH   |</span><br><span class="line">| 2          | Alice        |              |</span><br><span class="line">| 3          | Bob          | DIAB100 MYOP |</span><br><span class="line">| 4          | George       | ACNE DIAB100 |</span><br><span class="line">| 5          | Alain        | DIAB201      |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| patient_id | patient_name | conditions   |</span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">| 3          | Bob          | DIAB100 MYOP |</span><br><span class="line">| 4          | George       | ACNE DIAB100 | </span><br><span class="line">+------------+--------------+--------------+</span><br><span class="line">解释：Bob 和 George 都患有代码以 DIAB1 开头的疾病。</span><br></pre></td></tr></table></figure>
<h2 id="解析like">解析(like)</h2>
<p>题目很简单，难点在于如何匹配<code>conditions</code>中的字符串。在每一个疾病代码中，要有以<code>DIAB1</code>开头的才可以，而不是包含这个子字符串。因此可以用两种情况考虑：</p>
<ol type="1">
<li>排在第一个疾病代码中，所以使用<code>like</code>匹配是<code>like 'DIAB1%'</code></li>
<li>排在非第一个疾病代码中，所以使用<code>like</code>匹配是<code>like '% DIAB1%'</code>，因为每一个疾病代码使用空格分开，所以保证以该字符串开头，需要在前边加上空格。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> Patients</span><br><span class="line"><span class="keyword">where</span> conditions <span class="keyword">like</span> <span class="string">'DIAB1%'</span> <span class="keyword">or</span> conditions <span class="keyword">like</span> <span class="string">'% DIAB1%'</span>;</span><br></pre></td></tr></table></figure>
<p><strong>方法二：</strong></p>
<p>可以使用正则表达式进行匹配，正则表达式：<code>^DIAB1|\sDIAB1</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> Patients</span><br><span class="line"><span class="keyword">where</span> conditions regexp <span class="string">'^DIAB1|\\sDIAB1'</span>;</span><br></pre></td></tr></table></figure>
<h1 id="每台机器的进程平均运行时间">1661.每台机器的进程平均运行时间</h1>
<p>表: <code>Activity</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+----------------+---------+</span><br><span class="line">| Column Name    | Type    |</span><br><span class="line">+----------------+---------+</span><br><span class="line">| machine_id     | int     |</span><br><span class="line">| process_id     | int     |</span><br><span class="line">| activity_type  | enum    |</span><br><span class="line">| timestamp      | float   |</span><br><span class="line">+----------------+---------+</span><br><span class="line">该表展示了一家工厂网站的用户活动。</span><br><span class="line">(machine_id, process_id, activity_type) 是当前表的主键（具有唯一值的列的组合）。</span><br><span class="line">machine_id 是一台机器的ID号。</span><br><span class="line">process_id 是运行在各机器上的进程ID号。</span><br><span class="line">activity_type 是枚举类型 ('start', 'end')。</span><br><span class="line">timestamp 是浮点类型,代表当前时间(以秒为单位)。</span><br><span class="line">'start' 代表该进程在这台机器上的开始运行时间戳 , 'end' 代表该进程在这台机器上的终止运行时间戳。</span><br><span class="line">同一台机器，同一个进程都有一对开始时间戳和结束时间戳，而且开始时间戳永远在结束时间戳前面。</span><br></pre></td></tr></table></figure>
<p>现在有一个工厂网站由几台机器运行，每台机器上运行着
<strong>相同数量的进程</strong>
。编写解决方案，计算每台机器各自完成一个进程任务的平均耗时。</p>
<p>完成一个进程任务的时间指进程的<code>'end' 时间戳</code> 减去
<code>'start' 时间戳</code>。平均耗时通过计算每台机器上所有进程任务的总耗费时间除以机器上的总进程数量获得。</p>
<p>结果表必须包含<code>machine_id（机器ID）</code> 和对应的
<strong>average time（平均耗时）</strong> 别名
<code>processing_time</code>，且<strong>四舍五入保留3位小数。</strong></p>
<p>以 <strong>任意顺序</strong> 返回表。</p>
<p>具体参考例子如下。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Activity table:</span><br><span class="line">+------------+------------+---------------+-----------+</span><br><span class="line">| machine_id | process_id | activity_type | timestamp |</span><br><span class="line">+------------+------------+---------------+-----------+</span><br><span class="line">| 0          | 0          | start         | 0.712     |</span><br><span class="line">| 0          | 0          | end           | 1.520     |</span><br><span class="line">| 0          | 1          | start         | 3.140     |</span><br><span class="line">| 0          | 1          | end           | 4.120     |</span><br><span class="line">| 1          | 0          | start         | 0.550     |</span><br><span class="line">| 1          | 0          | end           | 1.550     |</span><br><span class="line">| 1          | 1          | start         | 0.430     |</span><br><span class="line">| 1          | 1          | end           | 1.420     |</span><br><span class="line">| 2          | 0          | start         | 4.100     |</span><br><span class="line">| 2          | 0          | end           | 4.512     |</span><br><span class="line">| 2          | 1          | start         | 2.500     |</span><br><span class="line">| 2          | 1          | end           | 5.000     |</span><br><span class="line">+------------+------------+---------------+-----------+</span><br><span class="line">输出：</span><br><span class="line">+------------+-----------------+</span><br><span class="line">| machine_id | processing_time |</span><br><span class="line">+------------+-----------------+</span><br><span class="line">| 0          | 0.894           |</span><br><span class="line">| 1          | 0.995           |</span><br><span class="line">| 2          | 1.456           |</span><br><span class="line">+------------+-----------------+</span><br><span class="line">解释：</span><br><span class="line">一共有3台机器,每台机器运行着两个进程.</span><br><span class="line">机器 0 的平均耗时: ((1.520 - 0.712) + (4.120 - 3.140)) / 2 = 0.894</span><br><span class="line">机器 1 的平均耗时: ((1.550 - 0.550) + (1.420 - 0.430)) / 2 = 0.995</span><br><span class="line">机器 2 的平均耗时: ((4.512 - 4.100) + (5.000 - 2.500)) / 2 = 1.456</span><br></pre></td></tr></table></figure>
<h2 id="解析-3">解析</h2>
<p>题目很容易看懂，难点在于如何找到每个进程的运行时间，也就是某个<code>machine_id</code>下的某个<code>process_id</code>的结束时间戳减开始时间戳。原来的表这两个值是在同一列，无法直接减，需要通过操作将这两个值放在同一行进行操作。</p>
<p>可以使用自连接操作，在连接时对连接条件进行判断，手动指定一个表留下开始时间戳，另一个表留下结束时间戳，然后根据<code>machine_id</code>分组，最后计算平均值即可。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a1.machine_id, round(<span class="built_in">avg</span>(a2.timestamp <span class="operator">-</span> a1.timestamp), <span class="number">3</span>) processing_time</span><br><span class="line"><span class="keyword">from</span> Activity a1</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> Activity a2</span><br><span class="line"><span class="keyword">on</span> a1.machine_id <span class="operator">=</span> a2.machine_id</span><br><span class="line"><span class="keyword">and</span> a1.process_id <span class="operator">=</span> a2.process_id</span><br><span class="line"><span class="keyword">and</span> a1.activity_type <span class="operator">=</span> <span class="string">'start'</span></span><br><span class="line"><span class="keyword">and</span> a2.activity_type <span class="operator">=</span> <span class="string">'end'</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a1.machine_id;</span><br></pre></td></tr></table></figure>
<p>使用<code>avg</code>函数可以直接计算平均值。他会遍历一个分组的所有的行，每行执行的操作是<code>a2.timestamp - a1.timestamp</code>，最后计算平均值。如有不懂可以再看一下<a href="#1179.重新格式化部门表">1179题</a>。</p>
<h1 id="员工的直属部门">1789.员工的直属部门</h1>
<p>表：<code>Employee</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   |  Type   |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| employee_id   | int     |</span><br><span class="line">| department_id | int     |</span><br><span class="line">| primary_flag  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">这张表的主键为 employee_id, department_id (具有唯一值的列的组合)</span><br><span class="line">employee_id 是员工的ID</span><br><span class="line">department_id 是部门的ID，表示员工与该部门有关系</span><br><span class="line">primary_flag 是一个枚举类型，值分别为('Y', 'N'). 如果值为'Y',表示该部门是员工的直属部门。 如果值是'N',则否</span><br></pre></td></tr></table></figure>
<p>一个员工可以属于多个部门。当一个员工加入<strong>超过一个部门</strong>的时候，他需要决定哪个部门是他的直属部门。请注意，当员工只加入一个部门的时候，那这个部门将默认为他的直属部门，虽然表记录的值为<code>'N'</code>.</p>
<p>请编写解决方案，查出员工所属的直属部门。</p>
<p>返回结果 <strong>没有顺序要求</strong> 。</p>
<p>返回结果格式如下例子所示：</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Employee table:</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">| employee_id | department_id | primary_flag |</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">| 1           | 1             | N            |</span><br><span class="line">| 2           | 1             | Y            |</span><br><span class="line">| 2           | 2             | N            |</span><br><span class="line">| 3           | 3             | N            |</span><br><span class="line">| 4           | 2             | N            |</span><br><span class="line">| 4           | 3             | Y            |</span><br><span class="line">| 4           | 4             | N            |</span><br><span class="line">+-------------+---------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| employee_id | department_id |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 1             |</span><br><span class="line">| 2           | 1             |</span><br><span class="line">| 3           | 3             |</span><br><span class="line">| 4           | 3             |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">解释：</span><br><span class="line">- 员工 1 的直属部门是 1</span><br><span class="line">- 员工 2 的直属部门是 1</span><br><span class="line">- 员工 3 的直属部门是 3</span><br><span class="line">- 员工 4 的直属部门是 3</span><br></pre></td></tr></table></figure>
<h2 id="解析union">解析(union)</h2>
<p>这道题分析可以了解到，一个员工的直属部门分为两种情况：</p>
<ul>
<li>只有一个部门的，无论<code>primary_flag</code>是<code>Y</code>还是<code>N</code>，直属部门就是<code>department_id</code>。</li>
<li>有多个部门的，当<code>primary_flag</code>是<code>Y</code>的为直属部门。</li>
</ul>
<p>因此可以使用<code>union</code>合并查询结果，第一次查询部门只有一个的员工，那么他的直属部门是确定的；第二次查询<code>primary_key</code>是<code>Y</code>的，那么他的直属部门也是确定的了。如果部门只有一个的员工中的<code>primary_flag</code>是<code>Y</code>，那么第二次查询也会查到这个数据，但是通过<code>union</code>操作会去除重复数据，因此不会影响最终结果。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> employee_id, department_id</span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> employee_id</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> employee_id, department_id</span><br><span class="line"><span class="keyword">from</span> Employee</span><br><span class="line"><span class="keyword">where</span> primary_flag <span class="operator">=</span> <span class="string">'Y'</span>;</span><br></pre></td></tr></table></figure>
<p>看<a class="link" target="_blank" rel="noopener" href="https://leetcode.cn/problems/primary-department-for-each-employee/solutions/2310026/xin-shou-ti-jie-fen-xi-ti-mu-yi-bu-yi-bu-ie49/comments/2087522">题解<i class="fas fa-external-link-alt"></i></a>了解到也可以使用窗口函数解答，但是目前没有学过窗口函数，先埋个坑🕳。</p>
<h1 id="连续出现的数字">180.连续出现的数字</h1>
<div id="180.连续出现的数字">

</div>
<p>表：<code>Logs</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| num         | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">在 SQL 中，id 是该表的主键。</span><br><span class="line">id 是一个自增列。</span><br></pre></td></tr></table></figure>
<p>找出所有至少连续出现三次的数字。</p>
<p>返回的结果表中的数据可以按 <strong>任意顺序</strong> 排列。</p>
<p>结果格式如下面的例子所示：</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Logs 表：</span><br><span class="line">+----+-----+</span><br><span class="line">| id | num |</span><br><span class="line">+----+-----+</span><br><span class="line">| 1  | 1   |</span><br><span class="line">| 2  | 1   |</span><br><span class="line">| 3  | 1   |</span><br><span class="line">| 4  | 2   |</span><br><span class="line">| 5  | 1   |</span><br><span class="line">| 6  | 2   |</span><br><span class="line">| 7  | 2   |</span><br><span class="line">+----+-----+</span><br><span class="line">输出：</span><br><span class="line">Result 表：</span><br><span class="line">+-----------------+</span><br><span class="line">| ConsecutiveNums |</span><br><span class="line">+-----------------+</span><br><span class="line">| 1               |</span><br><span class="line">+-----------------+</span><br><span class="line">解释：1 是唯一连续出现至少三次的数字。</span><br></pre></td></tr></table></figure>
<h2 id="解析连续n问题窗口函数">解析(连续n问题，窗口函数)</h2>
<p>窗口函数的内容可以参考这篇<a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/mjh1667002013/article/details/128140257">博客<i class="fas fa-external-link-alt"></i></a>。</p>
<p>连续n问题解题思路首先是利用窗口函数构造一个新的列，给每个<code>num</code>编号。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	<span class="operator">*</span></span><br><span class="line">	, <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> num <span class="keyword">order</span> <span class="keyword">by</span> id) id1</span><br><span class="line"><span class="keyword">from</span> Logs</span><br></pre></td></tr></table></figure>
<p>上述查询会构建一个新的列，按照<code>num</code>分组，<code>id</code>升序的顺序重新编号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">| id | num | id1 |</span><br><span class="line">| -- | --- | --- |</span><br><span class="line">| 1  | 1   | 1   |</span><br><span class="line">| 2  | 1   | 2   |</span><br><span class="line">| 3  | 1   | 3   |</span><br><span class="line">| 5  | 1   | 4   |</span><br><span class="line">| 4  | 2   | 1   |</span><br><span class="line">| 6  | 2   | 2   |</span><br><span class="line">| 7  | 2   | 3   |</span><br></pre></td></tr></table></figure>
<p>观察<code>id - id1</code>的值，可以发现，连续相同的数的这个差值是相同的。但是仍然会有问题，题目中<code>id</code>为自增主键，自增主键不一定完全连续，如果中间断开，则上述规律可能会不成立。因此可以再利用窗口函数<code>row_number()</code>构造一个新的列，使其完全连续。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    <span class="operator">*</span></span><br><span class="line">    , <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> num <span class="keyword">order</span> <span class="keyword">by</span> id) id1</span><br><span class="line">    , <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> id) id2</span><br><span class="line"><span class="keyword">from</span> Logs</span><br></pre></td></tr></table></figure>
<p>第二次窗口函数构建的列没有进行划分分组，直接按照<code>id</code>升序进行编号。即使<code>id</code>从中间某个数断开，<code>id2</code>也并不会断开。因此<code>id2 - id1</code>的差值满足以上规律。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">| id | num | id1 | id2 |</span><br><span class="line">| -- | --- | --- | --- |</span><br><span class="line">| 1  | 1   | 1   | 1   |</span><br><span class="line">| 2  | 1   | 2   | 2   |</span><br><span class="line">| 3  | 1   | 3   | 3   |</span><br><span class="line">| 4  | 2   | 1   | 4   |</span><br><span class="line">| 5  | 1   | 4   | 5   |</span><br><span class="line">| 6  | 2   | 2   | 6   |</span><br><span class="line">| 7  | 2   | 3   | 7   |</span><br></pre></td></tr></table></figure>
<p>实际测试中，如果只按照<code>id2 - id1</code>进行分组，仍然会出问题。</p>
<p>如以下数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----+-----+-----+-----+</span><br><span class="line">| id | num | id1 | id2 |</span><br><span class="line">+----+-----+-----+-----+</span><br><span class="line">| 1  | 1   | 1   | 1   |</span><br><span class="line">| 2  | 2   | 1   | 2   |</span><br><span class="line">| 3  | 1   | 2   | 3   |</span><br><span class="line">| 4  | 1   | 3   | 4   |</span><br><span class="line">+----+-----+-----+-----+</span><br></pre></td></tr></table></figure>
<p>因为窗口函数按照<code>num</code>分组后，即使<code>id = 1 3 4</code>的数据从中间断开，但是编号并没有断开，导致<code>id = 2 3 4</code>的数并不相同连续，但是<code>id2 - id1</code>却是相同的。因此最终分组时要按照<code>id2 - id1</code>和<code>num</code>分组，即使差值相同，但是<code>num</code>不同，仍然可以区分出来。</p>
<p>最终的<code>sql</code>为</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> num ConsecutiveNums</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">    <span class="operator">*</span></span><br><span class="line">    , <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> num <span class="keyword">order</span> <span class="keyword">by</span> id) id1</span><br><span class="line">    , <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> id) id2</span><br><span class="line">    <span class="keyword">from</span> Logs</span><br><span class="line">) tmp_logs</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> id2 <span class="operator">-</span> id1, num</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<p>最后查询结果需要使用<code>distinct</code>因为后边的连续的数字中可能会有和前边的相同的，结果只要有一个数字即可，因此需要去重。</p>
<h1 id="换座位">626.换座位</h1>
<p>表: <code>Seat</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| id          | int     |</span><br><span class="line">| student     | varchar |</span><br><span class="line">+-------------+---------+</span><br><span class="line">id 是该表的主键（唯一值）列。</span><br><span class="line">该表的每一行都表示学生的姓名和 ID。</span><br><span class="line">id 是一个连续的增量。</span><br></pre></td></tr></table></figure>
<p>编写解决方案来交换每两个连续的学生的座位号。如果学生的数量是奇数，则最后一个学生的id不交换。</p>
<p>按 <code>id</code> <strong>升序</strong> 返回结果表。</p>
<p>查询结果格式如下所示。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">输入: </span><br><span class="line">Seat 表:</span><br><span class="line">+----+---------+</span><br><span class="line">| id | student |</span><br><span class="line">+----+---------+</span><br><span class="line">| 1  | Abbot   |</span><br><span class="line">| 2  | Doris   |</span><br><span class="line">| 3  | Emerson |</span><br><span class="line">| 4  | Green   |</span><br><span class="line">| 5  | Jeames  |</span><br><span class="line">+----+---------+</span><br><span class="line">输出: </span><br><span class="line">+----+---------+</span><br><span class="line">| id | student |</span><br><span class="line">+----+---------+</span><br><span class="line">| 1  | Doris   |</span><br><span class="line">| 2  | Abbot   |</span><br><span class="line">| 3  | Green   |</span><br><span class="line">| 4  | Emerson |</span><br><span class="line">| 5  | Jeames  |</span><br><span class="line">+----+---------+</span><br><span class="line">解释:</span><br><span class="line">请注意，如果学生人数为奇数，则不需要更换最后一名学生的座位。</span><br></pre></td></tr></table></figure>
<h2 id="解析位运算求奇偶相邻">解析(位运算求奇偶相邻)</h2>
<p>题意很简单，而且<code>id</code>为连续上升的，所以很容易想到将偶数的<code>id</code>减一，将奇数的<code>id</code>加一，然后合并结果。但是这样会导致奇数人数情况下最后一个学生座位发生变化，因此最后套一层窗口函数进行一次排名即可。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> id) id</span><br><span class="line">    , student</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">        id <span class="operator">+</span> <span class="number">1</span> id</span><br><span class="line">        , student</span><br><span class="line">    <span class="keyword">from</span> Seat</span><br><span class="line">    <span class="keyword">where</span> <span class="built_in">mod</span>(id, <span class="number">2</span>) <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">union</span></span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">        id <span class="operator">-</span> <span class="number">1</span> id</span><br><span class="line">        , student</span><br><span class="line">    <span class="keyword">from</span> Seat</span><br><span class="line">    <span class="keyword">where</span> <span class="built_in">mod</span>(id, <span class="number">2</span>) <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">) t</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> id;</span><br></pre></td></tr></table></figure>
<p>在看了别人提交的代码后，学习到了一种更为巧妙的方法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="built_in">RANK</span>() <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> (id <span class="operator">-</span> <span class="number">1</span>) <span class="operator">^</span> <span class="number">1</span>) <span class="keyword">AS</span> id,</span><br><span class="line">    student</span><br><span class="line"><span class="keyword">FROM</span> seat</span><br></pre></td></tr></table></figure>
<p>题目中<code>id</code>连续，所以交换位置可以看作是<code>1和2</code>
<code>3和4</code>...交换，也就是将两个的<code>id</code>互换。这里运用了位运算，巧妙地实现了这个操作。</p>
<p>首先让<code>id - 1</code>，所以<code>id</code>是从<code>0, 1, 2</code>开始，然后和<code>1</code>进行异或操作。</p>
<p><code>0 = 0b00000000 ^ 0b00000001 = 0b00000001 = 1</code></p>
<p><code>1 = 0b00000001 ^ 0b00000001 = 0b00000000 = 0</code></p>
<p><code>2 = 0b00000010 ^ 0b00000001 = 0b00000011 = 3</code></p>
<p><code>3 = 0b00000011 ^ 0b00000001 = 0b00000010 = 2</code></p>
<p>巧妙地将两个相邻的数对换，最后再使用窗口函数进行一次排名即可。</p>
<p><mark>一个奇数与1做异或后得到的是比它小的相邻偶数，一个偶数与1做异或后得到的是比它大的相邻奇数。</mark></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">SELECT</span> s1.id, <span class="built_in">COALESCE</span>(s2.student, s1.student) student</span><br><span class="line"><span class="keyword">FROM</span> Seat s1</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Seat s2</span><br><span class="line"><span class="keyword">ON</span> s1.id <span class="operator">-</span> <span class="number">1</span> <span class="operator">=</span> (s2.id <span class="operator">-</span> <span class="number">1</span>) <span class="operator">^</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> s1.id</span><br></pre></td></tr></table></figure>
<p>使用上述规律做连接，将每个座位的匹配到交换后的位置，这里让字段先减1再做位运算，因为上述规律是从0开始算，这里是从1开始。</p>
<h1 id="产品销售分析iii">1070.产品销售分析III</h1>
<p>销售表 <code>Sales</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| sale_id     | int   |</span><br><span class="line">| product_id  | int   |</span><br><span class="line">| year        | int   |</span><br><span class="line">| quantity    | int   |</span><br><span class="line">| price       | int   |</span><br><span class="line">+-------------+-------+</span><br><span class="line">(sale_id, year) 是这张表的主键（具有唯一值的列的组合）。</span><br><span class="line">product_id 是产品表的外键（reference 列）。</span><br><span class="line">这张表的每一行都表示：编号 product_id 的产品在某一年的销售额。</span><br><span class="line">请注意，价格是按每单位计的。</span><br></pre></td></tr></table></figure>
<p>产品表 <code>Product</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| product_id   | int     |</span><br><span class="line">| product_name | varchar |</span><br><span class="line">+--------------+---------+</span><br><span class="line">product_id 是这张表的主键（具有唯一值的列）。</span><br><span class="line">这张表的每一行都标识：每个产品的 id 和 产品名称。</span><br></pre></td></tr></table></figure>
<p>编写解决方案，选出每个售出过的产品 <strong>第一年</strong> 销售的
<strong>产品 id</strong>、<strong>年份</strong>、<strong>数量</strong>
和 <strong>价格</strong>。</p>
<p>结果表中的条目可以按 <strong>任意顺序</strong> 排列。</p>
<p>结果格式如下例所示：</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Sales 表：</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line">| sale_id | product_id | year | quantity | price |</span><br><span class="line">+---------+------------+------+----------+-------+ </span><br><span class="line">| 1       | 100        | 2008 | 10       | 5000  |</span><br><span class="line">| 2       | 100        | 2009 | 12       | 5000  |</span><br><span class="line">| 7       | 200        | 2011 | 15       | 9000  |</span><br><span class="line">+---------+------------+------+----------+-------+</span><br><span class="line">Product 表：</span><br><span class="line">+------------+--------------+</span><br><span class="line">| product_id | product_name |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 100        | Nokia        |</span><br><span class="line">| 200        | Apple        |</span><br><span class="line">| 300        | Samsung      |</span><br><span class="line">+------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+------------+------------+----------+-------+</span><br><span class="line">| product_id | first_year | quantity | price |</span><br><span class="line">+------------+------------+----------+-------+ </span><br><span class="line">| 100        | 2008       | 10       | 5000  |</span><br><span class="line">| 200        | 2011       | 15       | 9000  |</span><br><span class="line">+------------+------------+----------+-------+</span><br></pre></td></tr></table></figure>
<h2 id="解析row_number和rank的异同">解析(row_number()和rank()的异同)</h2>
<p>这道题要找产品第一年的销售情况，可以利用窗口函数，给每个产品按照年份分组，然后进行排序。注意这里要使用<code>rank()</code>而不是<code>row_number()</code>。</p>
<p><code>rank</code>函数进行<code>order by</code>排序时，遇到相同值排名不会变化，直到遇到不同值排名会变化，并且会比上一个排名多重复值的长度。而<code>row_number</code>会一直递增。</p>
<p>这个题要查到的是每种第一年卖出的产品的情况，可能会存在某种产品第一年卖出去多次，这个也需要查出来。因此需要使用<code>rank</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_id, <span class="keyword">year</span> first_year, quantity, price</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">        <span class="operator">*</span></span><br><span class="line">        , <span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> product_id <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">year</span>) rownum </span><br><span class="line">    <span class="keyword">from</span> Sales</span><br><span class="line">) t</span><br><span class="line"><span class="keyword">where</span> rownum <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h1 id="餐馆营业额变化增长">1321.餐馆营业额变化增长</h1>
<p>表: <code>Customer</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">| visited_on    | date    |</span><br><span class="line">| amount        | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">在 SQL 中，(customer_id, visited_on) 是该表的主键。</span><br><span class="line">该表包含一家餐馆的顾客交易数据。</span><br><span class="line">visited_on 表示 (customer_id) 的顾客在 visited_on 那天访问了餐馆。</span><br><span class="line">amount 是一个顾客某一天的消费总额。</span><br></pre></td></tr></table></figure>
<p>你是餐馆的老板，现在你想分析一下可能的营业额变化增长（每天至少有一位顾客）。</p>
<p>计算以 7 天（某日期 + 该日期前的 6
天）为一个时间段的顾客消费平均值。<code>average_amount</code> 要
<strong>保留两位小数。</strong></p>
<p>结果按 <code>visited_on</code> <strong>升序排序</strong>。</p>
<p>返回结果格式的例子如下。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Customer 表:</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| customer_id | name         | visited_on   | amount      |</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| 1           | Jhon         | 2019-01-01   | 100         |</span><br><span class="line">| 2           | Daniel       | 2019-01-02   | 110         |</span><br><span class="line">| 3           | Jade         | 2019-01-03   | 120         |</span><br><span class="line">| 4           | Khaled       | 2019-01-04   | 130         |</span><br><span class="line">| 5           | Winston      | 2019-01-05   | 110         | </span><br><span class="line">| 6           | Elvis        | 2019-01-06   | 140         | </span><br><span class="line">| 7           | Anna         | 2019-01-07   | 150         |</span><br><span class="line">| 8           | Maria        | 2019-01-08   | 80          |</span><br><span class="line">| 9           | Jaze         | 2019-01-09   | 110         | </span><br><span class="line">| 1           | Jhon         | 2019-01-10   | 130         | </span><br><span class="line">| 3           | Jade         | 2019-01-10   | 150         | </span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">输出：</span><br><span class="line">+--------------+--------------+----------------+</span><br><span class="line">| visited_on   | amount       | average_amount |</span><br><span class="line">+--------------+--------------+----------------+</span><br><span class="line">| 2019-01-07   | 860          | 122.86         |</span><br><span class="line">| 2019-01-08   | 840          | 120            |</span><br><span class="line">| 2019-01-09   | 840          | 120            |</span><br><span class="line">| 2019-01-10   | 1000         | 142.86         |</span><br><span class="line">+--------------+--------------+----------------+</span><br><span class="line">解释：</span><br><span class="line">第一个七天消费平均值从 2019-01-01 到 2019-01-07 是restaurant-growth/restaurant-growth/ (100 + 110 + 120 + 130 + 110 + 140 + 150)/7 = 122.86</span><br><span class="line">第二个七天消费平均值从 2019-01-02 到 2019-01-08 是 (110 + 120 + 130 + 110 + 140 + 150 + 80)/7 = 120</span><br><span class="line">第三个七天消费平均值从 2019-01-03 到 2019-01-09 是 (120 + 130 + 110 + 140 + 150 + 80 + 110)/7 = 120</span><br><span class="line">第四个七天消费平均值从 2019-01-04 到 2019-01-10 是 (130 + 110 + 140 + 150 + 80 + 110 + 130 + 150)/7 = 142.86</span><br></pre></td></tr></table></figure>
<h2 id="解析窗口函数范围">解析(窗口函数范围)</h2>
<p>题目要求当前日期及前7天的营业额的平均值。很容易想到使用窗口函数，同时这道题也作为<a href="#180.连续出现的数字">180题</a>的补充</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[操作] <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> <span class="operator">&lt;</span>列名<span class="operator">&gt;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="operator">&lt;</span>列名<span class="operator">&gt;</span> <span class="keyword">rows</span> <span class="operator">&lt;</span>窗口滑动的数据范围<span class="operator">&gt;</span>)</span><br></pre></td></tr></table></figure>
<p>其中滑动范围用来限定要操作的数据的范围。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">当前行 <span class="operator">-</span> <span class="keyword">current</span> <span class="type">row</span></span><br><span class="line">之前的行 <span class="operator">-</span> preceding</span><br><span class="line">之后的行 <span class="operator">-</span> following</span><br><span class="line">无界限 <span class="operator">-</span> unbounded</span><br><span class="line">表示从前面的起点 <span class="operator">-</span> unbounded preceding</span><br><span class="line">表示到后面的终点 <span class="operator">-</span> unbounded following</span><br></pre></td></tr></table></figure>
<p>例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">取当前行和前五行：<span class="keyword">ROWS</span> <span class="keyword">between</span> <span class="number">5</span> preceding <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span> <span class="comment">--共6行</span></span><br><span class="line">取当前行和后五行：<span class="keyword">ROWS</span> <span class="keyword">between</span> <span class="keyword">current</span> <span class="type">row</span> <span class="keyword">and</span> <span class="number">5</span> following <span class="comment">--共6行</span></span><br><span class="line">取前五行和后五行：<span class="keyword">ROWS</span> <span class="keyword">between</span> <span class="number">5</span> preceding <span class="keyword">and</span> <span class="number">5</span> folowing <span class="comment">--共11行</span></span><br></pre></td></tr></table></figure>
<p>因此最后本题查询如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    visited_on</span><br><span class="line">    , sum_amount amount</span><br><span class="line">    , round(sum_amount <span class="operator">/</span> <span class="number">7</span>, <span class="number">2</span>) average_amount</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        visited_on</span><br><span class="line">        , <span class="built_in">sum</span>(amount) <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> visited_on <span class="keyword">rows</span> <span class="number">6</span> preceding) sum_amount</span><br><span class="line">    <span class="keyword">from</span> (</span><br><span class="line">        <span class="keyword">select</span> visited_on, <span class="built_in">sum</span>(amount) amount</span><br><span class="line">        <span class="keyword">from</span> Customer</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> visited_on</span><br><span class="line">    ) t</span><br><span class="line">) tt</span><br><span class="line"><span class="keyword">where</span> datediff(visited_on, (<span class="keyword">select</span> <span class="built_in">min</span>(visited_on) <span class="keyword">from</span> Customer)) <span class="operator">&gt;=</span> <span class="number">6</span>;</span><br></pre></td></tr></table></figure>
<p>最内层查询首先根据日期分组，获取每天的销售总额，因为可能存在同一天有多个客户的情况。</p>
<p>然后对子查询进行窗口函数计算。计算从当前行和前六行的和，虽然前6行往前不足6行，但是依旧可以计算，有多少行计算多少行。从第7行开始，计算的就是完整的7天的营业额。最后取出满足条件的日期即可。</p>
<p>本题说明了每天都至少有一个顾客的订单，所以日期肯定是连续的。</p>
<p>也可以不适用窗口函数，采用自连接方法，参考<a class="link" target="_blank" rel="noopener" href="https://leetcode.cn/problems/restaurant-growth/solutions/2462972/zheng-li-liang-chong-zhu-liu-de-jie-jue-c9x7b/">题解<i class="fas fa-external-link-alt"></i></a>。</p>
<h1 id="电影评分">1341.电影评分</h1>
<p>表：<code>Movies</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| movie_id      | int     |</span><br><span class="line">| title         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">movie_id 是这个表的主键(具有唯一值的列)。</span><br><span class="line">title 是电影的名字。</span><br></pre></td></tr></table></figure>
<p>表：<code>Users</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| name          | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">user_id 是表的主键(具有唯一值的列)。</span><br></pre></td></tr></table></figure>
<p>表：<code>MovieRating</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| movie_id      | int     |</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| rating        | int     |</span><br><span class="line">| created_at    | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(movie_id, user_id) 是这个表的主键(具有唯一值的列的组合)。</span><br><span class="line">这个表包含用户在其评论中对电影的评分 rating 。</span><br><span class="line">created_at 是用户的点评日期。 </span><br></pre></td></tr></table></figure>
<p>请你编写一个解决方案：</p>
<ul>
<li>查找评论电影数量最多的用户名。如果出现平局，返回字典序较小的用户名。</li>
<li>查找在 <code>February 2020</code> <strong>平均评分最高</strong>
的电影名称。如果出现平局，返回字典序较小的电影名称。</li>
</ul>
<p><strong>字典序</strong>
，即按字母在字典中出现顺序对字符串排序，字典序较小则意味着排序靠前。</p>
<p>返回结果格式如下例所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Movies 表：</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| movie_id    |  title       |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | Avengers     |</span><br><span class="line">| 2           | Frozen 2     |</span><br><span class="line">| 3           | Joker        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">Users 表：</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| user_id     |  name        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">| 1           | Daniel       |</span><br><span class="line">| 2           | Monica       |</span><br><span class="line">| 3           | Maria        |</span><br><span class="line">| 4           | James        |</span><br><span class="line">+-------------+--------------+</span><br><span class="line">MovieRating 表：</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| movie_id    | user_id      | rating       | created_at  |</span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">| 1           | 1            | 3            | 2020-01-12  |</span><br><span class="line">| 1           | 2            | 4            | 2020-02-11  |</span><br><span class="line">| 1           | 3            | 2            | 2020-02-12  |</span><br><span class="line">| 1           | 4            | 1            | 2020-01-01  |</span><br><span class="line">| 2           | 1            | 5            | 2020-02-17  | </span><br><span class="line">| 2           | 2            | 2            | 2020-02-01  | </span><br><span class="line">| 2           | 3            | 2            | 2020-03-01  |</span><br><span class="line">| 3           | 1            | 3            | 2020-02-22  | </span><br><span class="line">| 3           | 2            | 4            | 2020-02-25  | </span><br><span class="line">+-------------+--------------+--------------+-------------+</span><br><span class="line">输出：</span><br><span class="line">Result 表：</span><br><span class="line">+--------------+</span><br><span class="line">| results      |</span><br><span class="line">+--------------+</span><br><span class="line">| Daniel       |</span><br><span class="line">| Frozen 2     |</span><br><span class="line">+--------------+</span><br><span class="line">解释：</span><br><span class="line">Daniel 和 Monica 都点评了 3 部电影（"Avengers", "Frozen 2" 和 "Joker"） 但是 Daniel 字典序比较小。</span><br><span class="line">Frozen 2 和 Joker 在 2 月的评分都是 3.5，但是 Frozen 2 的字典序比较小。</span><br></pre></td></tr></table></figure>
<h2 id="解析union子句">解析(union子句)</h2>
<p>这道题思路很简单，两次查询，分别查出评分最多的人和评分最高的电影，最后使用<code>union</code>合并。</p>
<p>但是实际运行时会报错，原因是子句使用了<code>order by</code>
<code>limit</code>等，使用这些后不能直接和<code>union</code>操作，因此需要使用括号将两个子句括起来再合并。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> u.name results</span><br><span class="line">    <span class="keyword">from</span> MovieRating mr</span><br><span class="line">    <span class="keyword">inner</span> <span class="keyword">join</span> Users u</span><br><span class="line">    <span class="keyword">on</span> mr.user_id <span class="operator">=</span> u.user_id</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> mr.user_id</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">desc</span>, u.name <span class="keyword">asc</span></span><br><span class="line">    limit <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> m.title results</span><br><span class="line">    <span class="keyword">from</span> MovieRating mr</span><br><span class="line">    <span class="keyword">inner</span> <span class="keyword">join</span> Movies m</span><br><span class="line">    <span class="keyword">on</span> mr.movie_id <span class="operator">=</span> m.movie_id</span><br><span class="line">    <span class="keyword">where</span> date_format(mr.created_at, <span class="string">'%Y-%m'</span>) <span class="operator">=</span> <span class="string">'2020-02'</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> mr.movie_id</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">avg</span>(rating) <span class="keyword">desc</span>, m.title <span class="keyword">asc</span></span><br><span class="line">    limit <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h1 id="游戏玩法分析iv">550. 游戏玩法分析IV</h1>
<p>Table: <code>Activity</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--------------+---------+</span><br><span class="line">| Column Name  | Type    |</span><br><span class="line">+--------------+---------+</span><br><span class="line">| player_id    | int     |</span><br><span class="line">| device_id    | int     |</span><br><span class="line">| event_date   | date    |</span><br><span class="line">| games_played | int     |</span><br><span class="line">+--------------+---------+</span><br><span class="line">（player_id，event_date）是此表的主键（具有唯一值的列的组合）。</span><br><span class="line">这张表显示了某些游戏的玩家的活动情况。</span><br><span class="line">每一行是一个玩家的记录，他在某一天使用某个设备注销之前登录并玩了很多游戏（可能是 0）。</span><br></pre></td></tr></table></figure>
<p>编写解决方案，报告在首次登录的第二天再次登录的玩家的
<strong>比率</strong>，<strong>四舍五入到小数点后两位</strong>。换句话说，你需要计算从首次登录日期开始至少连续两天登录的玩家的数量，然后除以玩家总数。</p>
<p>结果格式如下所示：</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Activity table:</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| player_id | device_id | event_date | games_played |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">| 1         | 2         | 2016-03-01 | 5            |</span><br><span class="line">| 1         | 2         | 2016-03-02 | 6            |</span><br><span class="line">| 2         | 3         | 2017-06-25 | 1            |</span><br><span class="line">| 3         | 1         | 2016-03-02 | 0            |</span><br><span class="line">| 3         | 4         | 2018-07-03 | 5            |</span><br><span class="line">+-----------+-----------+------------+--------------+</span><br><span class="line">输出：</span><br><span class="line">+-----------+</span><br><span class="line">| fraction  |</span><br><span class="line">+-----------+</span><br><span class="line">| 0.33      |</span><br><span class="line">+-----------+</span><br><span class="line">解释：</span><br><span class="line">只有 ID 为 1 的玩家在第一天登录后才重新登录，所以答案是 1/3 = 0.33</span><br></pre></td></tr></table></figure>
<h2 id="解析-4">解析</h2>
<p>先求出每个玩家首次登录日期，然后进行左连接，判断每个玩家是否在第二天登录，如果未登录，则第二个表的字段会为<code>null</code>，依次可以判断最后的比率。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="built_in">AVG</span>(a.player_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>), <span class="number">2</span>) fraction</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> player_id, <span class="built_in">MIN</span>(event_date) event_date</span><br><span class="line">    <span class="keyword">FROM</span> Activity</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> player_id</span><br><span class="line">) t_login</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Activity a</span><br><span class="line"><span class="keyword">ON</span> DATEDIFF(a.event_date, t_login.event_date) <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">AND</span> t_login.player_id <span class="operator">=</span> a.player_id;</span><br></pre></td></tr></table></figure>
<h1 id="指定日期的产品价格">1164.指定日期的产品价格</h1>
<p>产品数据表: <code>Products</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| product_id    | int     |</span><br><span class="line">| new_price     | int     |</span><br><span class="line">| change_date   | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(product_id, change_date) 是此表的主键（具有唯一值的列组合）。</span><br><span class="line">这张表的每一行分别记录了 某产品 在某个日期 更改后 的新价格。</span><br></pre></td></tr></table></figure>
<p>编写一个解决方案，找出在 <code>2019-08-16</code>
时全部产品的价格，假设所有产品在修改前的价格都是 <code>10</code>
<strong>。</strong></p>
<p>以 <strong>任意顺序</strong> 返回结果表。</p>
<p>结果格式如下例所示。</p>
<p><strong>示例 1:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Products 表:</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line">| product_id | new_price | change_date |</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line">| 1          | 20        | 2019-08-14  |</span><br><span class="line">| 2          | 50        | 2019-08-14  |</span><br><span class="line">| 1          | 30        | 2019-08-15  |</span><br><span class="line">| 1          | 35        | 2019-08-16  |</span><br><span class="line">| 2          | 65        | 2019-08-17  |</span><br><span class="line">| 3          | 20        | 2019-08-18  |</span><br><span class="line">+------------+-----------+-------------+</span><br><span class="line">输出：</span><br><span class="line">+------------+-------+</span><br><span class="line">| product_id | price |</span><br><span class="line">+------------+-------+</span><br><span class="line">| 2          | 50    |</span><br><span class="line">| 1          | 35    |</span><br><span class="line">| 3          | 10    |</span><br><span class="line">+------------+-------+</span><br></pre></td></tr></table></figure>
<h2 id="解析-5">解析</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">SELECT</span> product_id, IF(filter_date <span class="keyword">IS</span> <span class="keyword">NULL</span>, <span class="number">10</span>, new_price) price</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        <span class="operator">*</span>,</span><br><span class="line">        <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> product_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> filter_date <span class="keyword">DESC</span>) rn</span><br><span class="line">    <span class="keyword">FROM</span> (</span><br><span class="line">        <span class="keyword">SELECT</span></span><br><span class="line">            <span class="operator">*</span>,</span><br><span class="line">            IF(DATEDIFF(<span class="string">'2019-08-16'</span>, change_date) <span class="operator">&gt;=</span> <span class="number">0</span>, change_date, <span class="keyword">NULL</span>) filter_date</span><br><span class="line">        <span class="keyword">FROM</span> Products</span><br><span class="line">    ) T1</span><br><span class="line">) T2</span><br><span class="line"><span class="keyword">WHERE</span> rn <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>首先排除不符合条件的日期，将其设置为<code>NULL</code>，然后使用窗口函数对其进行倒序排序加索引，这样就可以找到在规定日期之前的最近的日期，如果某个商品所有的日期都在规定日期之后，那么它的<code>filter_date</code>始终为<code>NULL</code>，进行排名后，无论哪个是<code>1</code>，都不会影响最终结果。</p>
<p>排序时，先按照不是<code>NULL</code>的值进行排序，然后其余为<code>NULL</code>的依次排列。</p>
<h1 id="年的投资">585. 2016年的投资</h1>
<p><code>Insurance</code> 表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+-------------+-------+</span><br><span class="line">| Column Name | Type  |</span><br><span class="line">+-------------+-------+</span><br><span class="line">| pid         | int   |</span><br><span class="line">| tiv_2015    | float |</span><br><span class="line">| tiv_2016    | float |</span><br><span class="line">| lat         | float |</span><br><span class="line">| lon         | float |</span><br><span class="line">+-------------+-------+</span><br><span class="line">pid 是这张表的主键(具有唯一值的列)。</span><br><span class="line">表中的每一行都包含一条保险信息，其中：</span><br><span class="line">pid 是投保人的投保编号。</span><br><span class="line">tiv_2015 是该投保人在 2015 年的总投保金额，tiv_2016 是该投保人在 2016 年的总投保金额。</span><br><span class="line">lat 是投保人所在城市的纬度。题目数据确保 lat 不为空。</span><br><span class="line">lon 是投保人所在城市的经度。题目数据确保 lon 不为空。</span><br></pre></td></tr></table></figure>
<p>编写解决方案报告 2016 年 (<code>tiv_2016</code>)
所有满足下述条件的投保人的投保金额之和：</p>
<ul>
<li>他在 2015 年的投保额 (<code>tiv_2015</code>) 至少跟一个其他投保人在
2015 年的投保额相同。</li>
<li>他所在的城市必须与其他投保人都不同（也就是说 (<code>lat, lon</code>)
不能跟其他任何一个投保人完全相同）。</li>
</ul>
<p><code>tiv_2016</code> 四舍五入的 <strong>两位小数</strong> 。</p>
<p>查询结果格式如下例所示。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">输入：</span><br><span class="line">Insurance 表：</span><br><span class="line">+-----+----------+----------+-----+-----+</span><br><span class="line">| pid | tiv_2015 | tiv_2016 | lat | lon |</span><br><span class="line">+-----+----------+----------+-----+-----+</span><br><span class="line">| 1   | 10       | 5        | 10  | 10  |</span><br><span class="line">| 2   | 20       | 20       | 20  | 20  |</span><br><span class="line">| 3   | 10       | 30       | 20  | 20  |</span><br><span class="line">| 4   | 10       | 40       | 40  | 40  |</span><br><span class="line">+-----+----------+----------+-----+-----+</span><br><span class="line">输出：</span><br><span class="line">+----------+</span><br><span class="line">| tiv_2016 |</span><br><span class="line">+----------+</span><br><span class="line">| 45.00    |</span><br><span class="line">+----------+</span><br><span class="line">解释：</span><br><span class="line">表中的第一条记录和最后一条记录都满足两个条件。</span><br><span class="line">tiv_2015 值为 10 与第三条和第四条记录相同，且其位置是唯一的。</span><br><span class="line"></span><br><span class="line">第二条记录不符合任何一个条件。其 tiv_2015 与其他投保人不同，并且位置与第三条记录相同，这也导致了第三条记录不符合题目要求。</span><br><span class="line">因此，结果是第一条记录和最后一条记录的 tiv_2016 之和，即 45 。</span><br></pre></td></tr></table></figure>
<h2 id="解析-6">解析</h2>
<p>需要求的是满足两个条件的投保人的投保金额总和。</p>
<p>使用<code>group by 和 count</code>判断<strong>唯一</strong>和<strong>不唯一</strong>这两个条件。分别求出满足两个条件的信息，然后进行过滤。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="built_in">SUM</span>(tiv_2016), <span class="number">2</span>) tiv_2016</span><br><span class="line"><span class="keyword">FROM</span> Insurance</span><br><span class="line"><span class="keyword">WHERE</span> CONCAT(lat, lon) <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> CONCAT(lat, lon)</span><br><span class="line">    <span class="keyword">FROM</span> Insurance</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> lat, lon</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> tiv_2015 <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> tiv_2015</span><br><span class="line">    <span class="keyword">FROM</span> Insurance</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> tiv_2015</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>❗注意：以下写法是错误的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Write your MySQL query statement below</span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="built_in">SUM</span>(tiv_2016), <span class="number">2</span>) tiv_2016</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">SUM</span>(tiv_2016) tiv_2016</span><br><span class="line">    <span class="keyword">FROM</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">        <span class="keyword">FROM</span> Insurance</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> lat, lon</span><br><span class="line">        <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    ) T1</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> tiv_2015</span><br><span class="line">    <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line">) T2</span><br></pre></td></tr></table></figure>
<p>该写法是先求出地理位置唯一的投保人，然后在地理位置唯一的人里判断<code>tiv_2015</code>这个是不是唯一的，这是错误的。</p>
<table>
<thead>
<tr>
<th>id</th>
<th>tiv_2015</th>
<th>lat, lon</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>1,2</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>1,3</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>1,3</td>
</tr>
</tbody>
</table>
<p>如该数据，其中<code>id=1</code>是满足条件的。但是如果按照上述错误做法来做的话，首先排除掉了<code>id=2,3</code>，然后判断<code>tiv_2015</code>，会发现排除了<code>id=2,3</code>后没有重复，但实际上是有重复的。</p>
<p><mark>该题本质上两个条件的比对是比对的在全局情况下是否唯一。而不是排除某些后剩下的数据里(不)唯一。</mark></p>

                </div>
                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                LeetCode SQL题笔记
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                ef9b8a95b3fe/leetcode-sql题笔记/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    作者
                </div>
                <div class="content">yatbfm</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    发布于
                </div>
                <div class="content">2023-12-01 21:39</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    许可
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="复制版权信息" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/LeetCode/">LeetCode</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/sql/">sql</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/1a70f07977f9/%E7%89%9B%E5%AE%A2%E7%BD%91sql%E9%A2%98/"
                                   title="牛客网SQL题"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">牛客网SQL题</span>
                                        <span class="post-nav-item">上一篇</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/4d2ab6272405/docker%E9%85%8D%E7%BD%AE%E5%AD%A6%E4%B9%A0/"
                                   title="docker配置学习"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">docker配置学习</span>
                                        <span class="post-nav-item">下一篇</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%8A%E5%8D%87%E7%9A%84%E6%B8%A9%E5%BA%A6"><span class="nav-text">197.上升的温度</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90datediff%E5%87%BD%E6%95%B0"><span class="nav-text">解析(datediff函数)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%A2%E5%8D%95%E6%9C%80%E5%A4%9A%E7%9A%84%E5%AE%A2%E6%88%B7"><span class="nav-text">586.订单最多的客户</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90"><span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E4%B8%89%E8%A7%92%E5%BD%A2"><span class="nav-text">610.判断三角形</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90case-when%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="nav-text">解析(case when条件判断)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%9C%80%E5%A4%A7%E6%95%B0%E5%AD%97"><span class="nav-text">619.只出现一次的最大数字</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90max%E5%87%BD%E6%95%B0"><span class="nav-text">解析(max函数)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90iii"><span class="nav-text">1084.销售分析III</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90count%E6%9D%A1%E4%BB%B6%E8%AE%A1%E6%95%B0"><span class="nav-text">解析(count条件计数)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mysql%E5%B8%B8%E7%94%A8%E5%9B%9B%E8%88%8D%E4%BA%94%E5%85%A5%E5%87%BD%E6%95%B0"><span class="nav-text">MySQL常用四舍五入函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mysql%E5%B8%B8%E7%94%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="nav-text">MySQL常用字符串函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mysql%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="nav-text">MySQL时间日期函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sql%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="nav-text">sql执行顺序</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E6%A0%BC%E5%BC%8F%E5%8C%96%E9%83%A8%E9%97%A8%E8%A1%A8"><span class="nav-text">1179.重新格式化部门表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90group-by%E5%8E%9F%E7%90%86%E8%A1%8C%E8%BD%AC%E5%88%97"><span class="nav-text">解析(group by原理，行转列)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%AF%8F%E4%B8%AA%E4%BA%A7%E5%93%81%E5%9C%A8%E4%B8%8D%E5%90%8C%E5%95%86%E5%BA%97%E7%9A%84%E4%BB%B7%E6%A0%BC"><span class="nav-text">1795.每个产品在不同商店的价格</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E5%88%97%E8%BD%AC%E8%A1%8C"><span class="nav-text">解析(列转行)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B9%B3%E5%9D%87%E5%94%AE%E4%BB%B7"><span class="nav-text">1251.平均售价</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-1"><span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%A6%E7%94%9F%E4%BB%AC%E5%8F%82%E5%8A%A0%E5%90%84%E7%A7%91%E6%B5%8B%E8%AF%95%E7%9A%84%E6%AC%A1%E6%95%B0"><span class="nav-text">1280.学生们参加各科测试的次数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-2"><span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%89%E6%97%A5%E6%9C%9F%E5%88%86%E7%BB%84%E9%94%80%E5%94%AE%E4%BA%A7%E5%93%81"><span class="nav-text">1484.按日期分组销售产品</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90group_concat%E5%87%BD%E6%95%B0"><span class="nav-text">解析(group_concat函数)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E6%8B%A5%E6%9C%89%E6%9C%89%E6%95%88%E9%82%AE%E7%AE%B1%E7%9A%84%E7%94%A8%E6%88%B7"><span class="nav-text">1517.查找拥有有效邮箱的用户</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-text">解析(正则表达式的应用)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%82%A3%E6%9F%90%E7%A7%8D%E7%96%BE%E7%97%85%E7%9A%84%E6%82%A3%E8%80%85"><span class="nav-text">1527.患某种疾病的患者</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90like"><span class="nav-text">解析(like)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%AF%8F%E5%8F%B0%E6%9C%BA%E5%99%A8%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%B9%B3%E5%9D%87%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="nav-text">1661.每台机器的进程平均运行时间</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-3"><span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%91%98%E5%B7%A5%E7%9A%84%E7%9B%B4%E5%B1%9E%E9%83%A8%E9%97%A8"><span class="nav-text">1789.员工的直属部门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90union"><span class="nav-text">解析(union)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%9E%E7%BB%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%95%B0%E5%AD%97"><span class="nav-text">180.连续出现的数字</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E8%BF%9E%E7%BB%ADn%E9%97%AE%E9%A2%98%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="nav-text">解析(连续n问题，窗口函数)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8D%A2%E5%BA%A7%E4%BD%8D"><span class="nav-text">626.换座位</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E4%BD%8D%E8%BF%90%E7%AE%97%E6%B1%82%E5%A5%87%E5%81%B6%E7%9B%B8%E9%82%BB"><span class="nav-text">解析(位运算求奇偶相邻)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%A7%E5%93%81%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90iii"><span class="nav-text">1070.产品销售分析III</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90row_number%E5%92%8Crank%E7%9A%84%E5%BC%82%E5%90%8C"><span class="nav-text">解析(row_number()和rank()的异同)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A4%90%E9%A6%86%E8%90%A5%E4%B8%9A%E9%A2%9D%E5%8F%98%E5%8C%96%E5%A2%9E%E9%95%BF"><span class="nav-text">1321.餐馆营业额变化增长</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E8%8C%83%E5%9B%B4"><span class="nav-text">解析(窗口函数范围)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%94%B5%E5%BD%B1%E8%AF%84%E5%88%86"><span class="nav-text">1341.电影评分</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90union%E5%AD%90%E5%8F%A5"><span class="nav-text">解析(union子句)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E7%8E%A9%E6%B3%95%E5%88%86%E6%9E%90iv"><span class="nav-text">550. 游戏玩法分析IV</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-4"><span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E6%97%A5%E6%9C%9F%E7%9A%84%E4%BA%A7%E5%93%81%E4%BB%B7%E6%A0%BC"><span class="nav-text">1164.指定日期的产品价格</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-5"><span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B9%B4%E7%9A%84%E6%8A%95%E8%B5%84"><span class="nav-text">585. 2016年的投资</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-6"><span class="nav-text">解析</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="border-box website-info-box default">
        
            <div class="copyright-info info-item default">
                &copy;&nbsp;<span>2020</span>&nbsp;-&nbsp;2025
                
                    &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">yatbfm</a>
                
            </div>

            <div class="theme-info info-item default">
                由&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;驱动&nbsp;&&nbsp;主题&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
            </div>

            

            
        

        <div class="count-item info-item default">
            

            
                <span class="count-box border-box uv">
                    <span class="item-type border-box">访客数</span>
                    <span class="item-value border-box uv" id="busuanzi_value_site_uv"></span>
                </span>
            

            
                <span class="count-box border-box pv">
                    <span class="item-type border-box">访问量</span>
                    <span class="item-value border-box pv" id="busuanzi_value_site_pv"></span>
                </span>
            
        </div>
    </div>
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="tools-list border-box">
        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-toggle-theme-mode flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%8A%E5%8D%87%E7%9A%84%E6%B8%A9%E5%BA%A6"><span class="nav-text">197.上升的温度</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90datediff%E5%87%BD%E6%95%B0"><span class="nav-text">解析(datediff函数)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%A2%E5%8D%95%E6%9C%80%E5%A4%9A%E7%9A%84%E5%AE%A2%E6%88%B7"><span class="nav-text">586.订单最多的客户</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90"><span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%A4%E6%96%AD%E4%B8%89%E8%A7%92%E5%BD%A2"><span class="nav-text">610.判断三角形</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90case-when%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD"><span class="nav-text">解析(case when条件判断)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AA%E5%87%BA%E7%8E%B0%E4%B8%80%E6%AC%A1%E7%9A%84%E6%9C%80%E5%A4%A7%E6%95%B0%E5%AD%97"><span class="nav-text">619.只出现一次的最大数字</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90max%E5%87%BD%E6%95%B0"><span class="nav-text">解析(max函数)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90iii"><span class="nav-text">1084.销售分析III</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90count%E6%9D%A1%E4%BB%B6%E8%AE%A1%E6%95%B0"><span class="nav-text">解析(count条件计数)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mysql%E5%B8%B8%E7%94%A8%E5%9B%9B%E8%88%8D%E4%BA%94%E5%85%A5%E5%87%BD%E6%95%B0"><span class="nav-text">MySQL常用四舍五入函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mysql%E5%B8%B8%E7%94%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="nav-text">MySQL常用字符串函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mysql%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="nav-text">MySQL时间日期函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sql%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="nav-text">sql执行顺序</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E6%A0%BC%E5%BC%8F%E5%8C%96%E9%83%A8%E9%97%A8%E8%A1%A8"><span class="nav-text">1179.重新格式化部门表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90group-by%E5%8E%9F%E7%90%86%E8%A1%8C%E8%BD%AC%E5%88%97"><span class="nav-text">解析(group by原理，行转列)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%AF%8F%E4%B8%AA%E4%BA%A7%E5%93%81%E5%9C%A8%E4%B8%8D%E5%90%8C%E5%95%86%E5%BA%97%E7%9A%84%E4%BB%B7%E6%A0%BC"><span class="nav-text">1795.每个产品在不同商店的价格</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E5%88%97%E8%BD%AC%E8%A1%8C"><span class="nav-text">解析(列转行)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B9%B3%E5%9D%87%E5%94%AE%E4%BB%B7"><span class="nav-text">1251.平均售价</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-1"><span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%A6%E7%94%9F%E4%BB%AC%E5%8F%82%E5%8A%A0%E5%90%84%E7%A7%91%E6%B5%8B%E8%AF%95%E7%9A%84%E6%AC%A1%E6%95%B0"><span class="nav-text">1280.学生们参加各科测试的次数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-2"><span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%89%E6%97%A5%E6%9C%9F%E5%88%86%E7%BB%84%E9%94%80%E5%94%AE%E4%BA%A7%E5%93%81"><span class="nav-text">1484.按日期分组销售产品</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90group_concat%E5%87%BD%E6%95%B0"><span class="nav-text">解析(group_concat函数)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E6%8B%A5%E6%9C%89%E6%9C%89%E6%95%88%E9%82%AE%E7%AE%B1%E7%9A%84%E7%94%A8%E6%88%B7"><span class="nav-text">1517.查找拥有有效邮箱的用户</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-text">解析(正则表达式的应用)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%82%A3%E6%9F%90%E7%A7%8D%E7%96%BE%E7%97%85%E7%9A%84%E6%82%A3%E8%80%85"><span class="nav-text">1527.患某种疾病的患者</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90like"><span class="nav-text">解析(like)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%AF%8F%E5%8F%B0%E6%9C%BA%E5%99%A8%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%B9%B3%E5%9D%87%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="nav-text">1661.每台机器的进程平均运行时间</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-3"><span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%91%98%E5%B7%A5%E7%9A%84%E7%9B%B4%E5%B1%9E%E9%83%A8%E9%97%A8"><span class="nav-text">1789.员工的直属部门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90union"><span class="nav-text">解析(union)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%9E%E7%BB%AD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%95%B0%E5%AD%97"><span class="nav-text">180.连续出现的数字</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E8%BF%9E%E7%BB%ADn%E9%97%AE%E9%A2%98%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="nav-text">解析(连续n问题，窗口函数)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8D%A2%E5%BA%A7%E4%BD%8D"><span class="nav-text">626.换座位</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E4%BD%8D%E8%BF%90%E7%AE%97%E6%B1%82%E5%A5%87%E5%81%B6%E7%9B%B8%E9%82%BB"><span class="nav-text">解析(位运算求奇偶相邻)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%A7%E5%93%81%E9%94%80%E5%94%AE%E5%88%86%E6%9E%90iii"><span class="nav-text">1070.产品销售分析III</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90row_number%E5%92%8Crank%E7%9A%84%E5%BC%82%E5%90%8C"><span class="nav-text">解析(row_number()和rank()的异同)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A4%90%E9%A6%86%E8%90%A5%E4%B8%9A%E9%A2%9D%E5%8F%98%E5%8C%96%E5%A2%9E%E9%95%BF"><span class="nav-text">1321.餐馆营业额变化增长</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E8%8C%83%E5%9B%B4"><span class="nav-text">解析(窗口函数范围)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%94%B5%E5%BD%B1%E8%AF%84%E5%88%86"><span class="nav-text">1341.电影评分</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90union%E5%AD%90%E5%8F%A5"><span class="nav-text">解析(union子句)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E7%8E%A9%E6%B3%95%E5%88%86%E6%9E%90iv"><span class="nav-text">550. 游戏玩法分析IV</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-4"><span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E6%97%A5%E6%9C%9F%E7%9A%84%E4%BA%A7%E5%93%81%E4%BB%B7%E6%A0%BC"><span class="nav-text">1164.指定日期的产品价格</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-5"><span class="nav-text">解析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B9%B4%E7%9A%84%E6%8A%95%E8%B5%84"><span class="nav-text">585. 2016年的投资</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E6%9E%90-6"><span class="nav-text">解析</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>



<!-- common -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local-search -->

    
<script src="/js/local-search.js"></script>



<!-- lazyload -->


<div class="">
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        
            
<script src="/js/post/toc.js"></script>

        

        <!-- copyright-info -->
        
            
<script src="/js/post/copyright-info.js"></script>

        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->

    
<script src="//cdn.jsdelivr.net/npm/mermaid@10.5.0/dist/mermaid.min.js"></script>






<!-- pjax -->



    
        
            
<script class="custom-inject-js" src="/js/custom.js" data-pjax></script>

        
    

</body>
</html>
